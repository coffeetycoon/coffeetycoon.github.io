<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Coffee Tycoon v1.10</title>
<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  * { font-family: 'Comfortaa', cursive; box-sizing: border-box; }
  body { 
    margin: 0; 
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); 
    color: #f5f5f5; 
    min-height: 100vh;
  }
  header { 
    padding: 24px; 
    text-align: center; 
    background: rgba(45, 45, 45, 0.95);
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    position: relative;
  }
  header h1 { 
    margin: 0 0 8px 0; 
    font-size: 2.5rem; 
    font-weight: 700;
    background: linear-gradient(135deg, #d4a574, #8b6f47);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  header p { 
    margin: 4px 0; 
    font-size: 1rem; 
    opacity: 0.9;
  }
  .header-buttons {
    position: absolute;
    top: 24px;
    right: 24px;
    display: flex;
    gap: 12px;
  }
  .help-btn, .info-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(212, 165, 116, 0.5);
    color: #d4a574;
    font-size: 1.3rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .help-btn:hover, .info-btn:hover {
    background: rgba(212, 165, 116, 0.2);
    transform: scale(1.1);
    border-color: #d4a574;
  }
  .status-bar {
    display: flex;
    justify-content: center;
    gap: 32px;
    margin: 16px 0;
    flex-wrap: wrap;
  }
  .stat {
    background: rgba(255, 255, 255, 0.1);
    padding: 12px 24px;
    border-radius: 12px;
    font-size: 1.1rem;
    font-weight: 600;
    backdrop-filter: blur(5px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  }
  main { 
    max-width: 1400px; 
    margin: 0 auto; 
    padding: 24px; 
  }
  .tabs {
    display: flex;
    gap: 12px;
    margin-bottom: 24px;
    justify-content: center;
    flex-wrap: wrap;
  }
  .tab-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid transparent;
    padding: 12px 28px;
    border-radius: 12px;
    color: #f5f5f5;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    backdrop-filter: blur(5px);
    position: relative;
  }
  .tab-btn:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  }
  .tab-btn.active {
    background: linear-gradient(135deg, #d4a574, #8b6f47);
    border-color: #d4a574;
    color: #1a1a2e;
  }
  .notification-badge {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 7px;
    height: 7px;
    min-width: 7px;
    padding: 0;
    margin-left: 0;
    border-radius: 50%;
    font-size: 0;
    border: 1px solid #1a1a2e;
    pointer-events: none;
    background: #ff4444;
  }
  .content-area {
    background: rgba(45, 45, 45, 0.8);
    border-radius: 16px;
    padding: 24px;
    min-height: 400px;
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  }
  .tab-content { display: none; }
  .tab-content.active { display: block; }
  
  .buy-mode-selector {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }
  .buy-mode-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(255, 255, 255, 0.2);
    padding: 10px 20px;
    border-radius: 10px;
    color: #f5f5f5;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }
  .buy-mode-btn:hover {
    background: rgba(255, 255, 255, 0.15);
  }
  .buy-mode-btn.active {
    background: linear-gradient(135deg, #4CAF50, #45a049);
    border-color: #4CAF50;
    color: #fff;
  }
  
  .shop-item, .upgrade-item {
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 16px;
    transition: all 0.3s ease;
  }
  .shop-item:hover, .upgrade-item:hover {
    border-color: rgba(212, 165, 116, 0.5);
    background: rgba(255, 255, 255, 0.08);
  }
  .shop-item.affordable, .upgrade-item.affordable {
    border-color: rgba(76, 175, 80, 0.5);
    background: rgba(76, 175, 80, 0.1);
  }
  .shop-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 12px;
  }
  .item-info {
    flex: 1;
    min-width: 200px;
  }
  .item-name, .upgrade-name {
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 4px;
    color: #d4a574;
  }
  .item-effect {
    font-size: 0.95rem;
    opacity: 0.9;
  }
  .item-actions {
    display: flex;
    gap: 12px;
    align-items: center;
    flex-wrap: wrap;
  }
  .quantity-display {
    background: rgba(255, 255, 255, 0.1);
    padding: 8px 16px;
    border-radius: 8px;
    font-weight: 600;
    min-width: 40px;
    text-align: center;
  }
  .buy-btn, .sell-btn, .upgrade-buy-btn {
    background: linear-gradient(135deg, #4CAF50, #45a049);
    border: none;
    padding: 12px 24px;
    border-radius: 10px;
    color: #fff;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
  }
  .sell-btn {
    background: linear-gradient(135deg, #ff6b6b, #ff5252);
    box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
  }
  .buy-btn:hover:not(:disabled), .sell-btn:hover:not(:disabled), .upgrade-buy-btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(76, 175, 80, 0.4);
  }
  .sell-btn:hover:not(:disabled) {
    box-shadow: 0 6px 16px rgba(255, 107, 107, 0.4);
  }
  .buy-btn:active:not(:disabled), .sell-btn:active:not(:disabled), .upgrade-buy-btn:active:not(:disabled) {
    transform: translateY(0);
  }
  .buy-btn:disabled, .sell-btn:disabled, .upgrade-buy-btn:disabled {
    background: rgba(100, 100, 100, 0.5);
    cursor: not-allowed;
    box-shadow: none;
  }
  .cost-tile {
    background: rgba(212, 165, 116, 0.2);
    border: 2px solid rgba(212, 165, 116, 0.5);
    padding: 10px 20px;
    border-radius: 10px;
    font-weight: 700;
    font-size: 1.1rem;
    color: #d4a574;
    min-width: 120px;
    text-align: center;
  }
  .upgrade-item.purchased {
    border-color: rgba(255, 215, 0, 0.5);
    background: rgba(255, 215, 0, 0.1);
    opacity: 0.6;
  }
  .upgrade-item.locked {
    border-color: rgba(255, 255, 255, 0.05);
    background: rgba(255, 255, 255, 0.02);
    opacity: 0.5;
  }
  .upgrade-item.locked:hover {
    border-color: rgba(255, 255, 255, 0.1);
    background: rgba(255, 255, 255, 0.03);
  }
  .upgrade-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    gap: 12px;
  }
  .upgrade-name {
    flex: 1;
    min-width: 0;
  }
  .upgrade-status {
    font-size: 1.1rem;
    font-weight: 600;
    color: #ffd700;
    white-space: nowrap;
    flex-shrink: 0;
  }
  .upgrade-status.locked {
    color: #ff6b6b;
  }
  .upgrade-description {
    font-size: 1rem;
    line-height: 1.6;
    margin-bottom: 16px;
    opacity: 0.9;
  }
  .upgrade-unlock-req {
    font-size: 0.9rem;
    color: #ff6b6b;
    margin-top: 8px;
    font-style: italic;
  }
  .upgrade-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .upgrade-pack {
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    margin-bottom: 16px;
  }
  .upgrade-pack:hover {
    border-color: rgba(212, 165, 116, 0.5);
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-2px);
  }
  .upgrade-pack-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }
  .upgrade-pack-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: #d4a574;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .upgrade-pack-icon {
    font-size: 1.5rem;
  }
  .upgrade-pack-progress {
    font-size: 1.1rem;
    font-weight: 600;
    color: #4CAF50;
  }
  .upgrade-pack-description {
    opacity: 0.9;
    margin-bottom: 12px;
  }
  .upgrade-pack-preview {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-bottom: 12px;
  }
  .upgrade-pack-badge {
    font-size: 1.5rem;
  }
  .upgrade-pack-toggle {
    font-size: 1rem;
    opacity: 0.6;
    margin-top: 8px;
    text-align: center;
    font-weight: 600;
  }
  .upgrade-pack-content {
    max-height: 10000px;
    transition: max-height 0.3s ease, opacity 0.3s ease, margin-top 0.3s ease;
    margin-top: 16px;
    overflow: visible;
  }
  .upgrade-pack-content.collapsed {
    max-height: 0;
    opacity: 0;
    overflow: hidden;
    margin-top: 0;
  }
  #coffeeButton {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    background: linear-gradient(135deg, #d4a574, #8b6f47);
    border: none;
    font-size: 4rem;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 8px 24px rgba(212, 165, 116, 0.4);
    margin: 20px auto;
    display: block;
  }
  #coffeeButton:hover {
    transform: scale(1.05);
    box-shadow: 0 12px 32px rgba(212, 165, 116, 0.5);
  }
  #coffeeButton:active {
    transform: scale(0.95);
  }
  .achievement {
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 16px;
  }
  .achievement.unlocked {
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.1);
  }
  .achievement.claimed {
    border-color: #4CAF50;
    background: rgba(76, 175, 80, 0.1);
  }
  .achievements-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
    gap: 16px;
  }
  .achievement-pack {
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
  }
  .achievement-pack:hover {
    border-color: rgba(212, 165, 116, 0.5);
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-2px);
  }
  .achievement-pack .notification-badge {
    top: 16px;
    right: 16px;
  }
  .pack-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }
  .pack-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: #d4a574;
  }
  .pack-progress {
    font-size: 1.1rem;
    font-weight: 600;
    color: #4CAF50;
  }
  .pack-description {
    opacity: 0.9;
    margin-bottom: 12px;
  }
  .pack-preview {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }
  .pack-badge {
    font-size: 1.5rem;
  }
  .achievement-reward {
    background: rgba(76, 175, 80, 0.1);
    border: 1px solid rgba(76, 175, 80, 0.3);
    padding: 8px 12px;
    border-radius: 8px;
    margin-top: 8px;
    font-size: 0.9rem;
    color: #4CAF50;
    font-weight: 600;
  }
  .modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    animation: fadeIn 0.3s ease;
  }
  .modal.hidden {
    display: none;
  }
  .modal-content {
    background: linear-gradient(135deg, #2d2d2d, #1a1a2e);
    border: 3px solid #d4a574;
    border-radius: 20px;
    padding: 32px;
    max-width: 900px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
  }
  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
  }
  .modal-title {
    font-size: 2rem;
    font-weight: 700;
    color: #d4a574;
  }
  .modal-close {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: #f5f5f5;
    font-size: 2rem;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.2s ease;
    line-height: 1;
  }
  .modal-close:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: rotate(90deg);
  }
  .modal-achievements {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 16px;
  }
  .modal-achievement {
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 16px;
    transition: all 0.3s ease;
  }
  .modal-achievement.unlocked {
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.1);
  }
  .modal-achievement.claimed {
    border-color: #4CAF50;
    background: rgba(76, 175, 80, 0.1);
  }
  .modal-achievement.unclaimed {
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.15);
    cursor: pointer;
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
    animation: achievement-glow 2s ease-in-out infinite;
  }
  .modal-achievement.unclaimed:hover {
    transform: scale(1.02);
    box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
  }
  @keyframes achievement-glow {
    0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.4); }
    50% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.6); }
  }
  .version-content {
    line-height: 1.8;
  }
  .version-content h3 {
    color: #d4a574;
    margin-top: 24px;
    margin-bottom: 12px;
  }
  .version-content ul {
    margin: 12px 0;
    padding-left: 24px;
  }
  .version-content li {
    margin: 8px 0;
  }
  .version-content a {
    color: #4CAF50;
    text-decoration: none;
    transition: color 0.3s ease;
  }
  .version-content a:hover {
    color: #66BB6A;
    text-decoration: underline;
  }
  .progress {
    height: 8px;
    background: #555;
    border-radius: 4px;
    overflow: hidden;
    margin-top: 8px;
  }
  .progress-bar {
    height: 100%;
    background: #d2691e;
    transition: width 0.3s;
  }
  .prestige-container {
    max-width: 700px;
    margin: 0 auto;
  }
  .prestige-info {
    background: rgba(255, 215, 0, 0.1);
    border: 2px solid rgba(255, 215, 0, 0.3);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 24px;
    text-align: center;
  }
  .prestige-button {
    background: linear-gradient(135deg, #ffd700, #ffed4e);
    border: none;
    padding: 20px 48px;
    border-radius: 16px;
    color: #1a1a2e;
    font-size: 1.3rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
    display: block;
    margin: 24px auto;
    width: 100%;
    max-width: 400px;
  }
  .prestige-button:hover:not(:disabled) {
    transform: translateY(-3px);
    box-shadow: 0 8px 28px rgba(255, 215, 0, 0.5);
  }
  .prestige-button:disabled {
    background: rgba(100, 100, 100, 0.5);
    cursor: not-allowed;
    opacity: 0.5;
  }
  .notification-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: 10px;
    pointer-events: none;
    max-width: 420px;
  }
  .notification {
    background: linear-gradient(135deg, #2d2d2d, #1a1a2e);
    border: 2px solid #d4a574;
    border-radius: 12px;
    padding: 16px 20px;
    min-width: 300px;
    max-width: 400px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
    animation: slideInNotif 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    pointer-events: auto;
    cursor: pointer;
    transition: opacity 0.3s ease, transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    opacity: 1;
    transform: translateX(0);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-bottom: 0;
  }
  .notification:hover {
    transform: translateX(-4px);
  }
  .notification.fade-out {
    opacity: 0;
    transform: translateX(450px);
    transition: opacity 0.3s ease, transform 0.3s ease;
  }
  .notification.achievement-notif {
    border-color: #ffd700;
    background: linear-gradient(135deg, #3d3d1e, #2a2a1e);
  }
  .notification.upgrade-notif {
    border-color: #4CAF50;
    background: linear-gradient(135deg, #1e3d2d, #1e2a2a);
  }
  .notification.purchase-notif {
    border-color: #66BB6A;
    background: linear-gradient(135deg, #1e2a2a, #1e3d2d);
  }
  .notification.purchase-notif .notification-title {
    color: #66BB6A;
  }
  .notification-title {
    font-size: 1.1rem;
    font-weight: 700;
    margin-bottom: 4px;
    color: #d4a574;
    line-height: 1.3;
  }
  .notification.achievement-notif .notification-title {
    color: #ffd700;
  }
  .notification.upgrade-notif .notification-title {
    color: #4CAF50;
  }
  .notification-message {
    font-size: 0.95rem;
    opacity: 0.9;
    line-height: 1.4;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  @keyframes slideInNotif {
    from { 
      transform: translateX(450px); 
      opacity: 0; 
    }
    to { 
      transform: translateX(0); 
      opacity: 1; 
    }
  }
  .overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    animation: fadeIn 0.3s ease;
  }
  .overlay.hidden { display: none; }
  .instructions-modal {
    background: linear-gradient(135deg, #2d2d2d, #1a1a2e);
    border: 3px solid #d4a574;
    border-radius: 20px;
    padding: 40px;
    max-width: 600px;
    width: 90%;
    box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
    max-height: 90vh;
    overflow-y: auto;
  }
  .instructions-modal h2 {
    margin-top: 0;
    color: #d4a574;
    font-size: 2rem;
    text-align: center;
  }
  .key-guide {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 16px;
    margin: 16px 0;
  }
  .key-item {
    display: flex;
    align-items: center;
    margin: 8px 0;
  }
  .key {
    background: linear-gradient(135deg, #d4a574, #8b6f47);
    color: #1a1a2e;
    padding: 8px 16px;
    border-radius: 8px;
    font-weight: 700;
    min-width: 40px;
    text-align: center;
    margin-right: 16px;
  }
  .start-btn {
    background: linear-gradient(135deg, #d4a574, #8b6f47);
    border: none;
    padding: 16px 48px;
    border-radius: 12px;
    color: #1a1a2e;
    font-size: 1.2rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s ease;
    display: block;
    margin: 24px auto 0;
  }
  .start-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(212, 165, 116, 0.5);
  }
  .empty-state {
    text-align: center;
    padding: 40px;
    opacity: 0.6;
    font-size: 1.1rem;
    grid-column: 1 / -1;
  }
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
</style>
</head>
<body>
<div id="notificationContainer" class="notification-container"></div>

<div id="instructionsOverlay" class="overlay hidden">
  <div class="instructions-modal">
    <h2>Welcome to Coffee Tycoon!</h2>
    <h3 style="color: #d4a574; margin-top: 24px;">How to Play:</h3>
    <p>Build your coffee empire from the ground up! Click the coffee cup to brew coffee manually, then purchase items from the Shop to automate your production.</p>
    <h3 style="color: #d4a574; margin-top: 24px;">Quick Keys:</h3>
    <div class="key-guide">
      <div class="key-item">
        <span class="key">1</span>
        <span>Brew House - Manual brewing</span>
      </div>
      <div class="key-item">
        <span class="key">2</span>
        <span>Shop - Purchase production items</span>
      </div>
      <div class="key-item">
        <span class="key">3</span>
        <span>Upgrades - Permanent improvements</span>
      </div>
      <div class="key-item">
        <span class="key">4</span>
        <span>Prestige - Reset for bonuses</span>
      </div>
      <div class="key-item">
        <span class="key">5</span>
        <span>Achievements - Track progress & earn rewards</span>
      </div>
    </div>
    <h3 style="color: #d4a574; margin-top: 24px;">Goal:</h3>
    <p>Earn coffee, unlock upgrades progressively, and reach 10 billion coffee to prestige for permanent Golden Coffee bonuses!</p>
    <button class="start-btn" id="startGameBtn">Start Brewing!</button>
  </div>
</div>

<div id="versionModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Coffee Tycoon v1.10</div>
      <button class="modal-close" id="closeVersionModal">Ã—</button>
    </div>
    <div class="version-content">
      <h3>What's New in v1.10 â€” A Whole Latte Trade</h3>
      <ul>
        <li><strong>Progressive Shop Unlocking:</strong> Buildings appear when you can afford â‰¥50% of their base cost</li>
        <li><strong>8 New High-Tier Buildings:</strong> Coffee Planet, Solar System, Galaxy, Universe, Continent, Country, Multiverse, and more!</li>
        <li><strong>Bulk Buy System:</strong> Purchase Ã—1, Ã—10, or Ã—100 buildings at once with smart cost calculation</li>
        <li><strong>Sell Buildings:</strong> Sell items for 50% refund when you need quick coffee</li>
        <li><strong>Building Buffs:</strong> All buildings from Coffee Grinder onwards buffed 2Ã—-5Ã— for faster progression</li>
        <li><strong>CPS Achievement Pack:</strong> New achievements tracking your CPS from 1 to 100 quintillion!</li>
        <li><strong>Coffee Pun Achievements:</strong> All achievements renamed with clever coffee-themed names</li>
        <li><strong>Better Notifications:</strong> Fixed duplicate notifications and improved claim messages</li>
      </ul>
      <h3>Gameplay Tips</h3>
      <ul>
        <li>Use bulk buy to quickly scale up your production</li>
        <li>Sell buildings strategically to afford the next tier faster</li>
        <li>Watch for new buildings to unlock as you earn more coffee</li>
        <li>Achievement rewards now properly display "Claimed" instead of "Purchase"</li>
      </ul>
      <h3>About</h3>
      <p><strong>Version:</strong> 1.10 - A Whole Latte Trade</p>
      <p><strong>Created by:</strong> Sanchit P.</p>
      <p><strong>Play Online:</strong> <a href="https://coffeetycoon.github.io/Coffee-Tycoon/" target="_blank">coffeetycoon.github.io/Coffee-Tycoon</a></p>
      <p><strong>GitHub:</strong> <a href="https://github.com/CoffeeTycoon/Coffee-Tycoon" target="_blank">View Repository</a></p>
      <p><strong>Report a Bug:</strong> <a href="https://github.com/coffeetycoon/Coffee-Tycoon/issues" target="_blank">Bug Reporting</a></p>
    </div>
  </div>
</div>

<header>
  <div class="header-buttons">
    <button class="help-btn" id="helpBtn" title="Help">?</button>
    <button class="info-btn" id="infoBtn" title="Info">i</button>
  </div>
  <h1>Coffee Tycoon</h1>
  <p>Brew coffee, earn rewards, and build your empire!</p>
  <div class="status-bar">
    <div class="stat">Coffee: <span id="coffeeDisplay">0</span></div>
    <div class="stat">CPS: <span id="cpsDisplay">0</span></div>
    <div class="stat">Golden Coffee: <span id="goldenCoffeeDisplay">0</span></div>
  </div>
</header>

<main>
  <div class="tabs">
    <button class="tab-btn active" data-tab="brew">Brew House</button>
    <button class="tab-btn" data-tab="shop">Shop</button>
    <button class="tab-btn" data-tab="upgrades">Upgrades</button>
    <button class="tab-btn" data-tab="prestige">Prestige</button>
    <button class="tab-btn" data-tab="achievements">Achievements</button>
  </div>
  <div class="content-area">
    <div id="brewTab" class="tab-content active">
      <div style="text-align: center;">
        <button id="coffeeButton">â˜•</button>
        <div style="font-size: 1.2rem; margin-top: 16px;">Click the cup to brew coffee!</div>
        <div style="margin-top: 12px; opacity: 0.8;">Each click: +<span id="clickPowerDisplay">1</span> Coffee</div>
      </div>
    </div>
    <div id="shopTab" class="tab-content">
      <h2 style="margin-top: 0; color: #d4a574;">Shop</h2>
      <div class="buy-mode-selector">
        <button class="buy-mode-btn active" data-mode="1">Buy Ã—1</button>
        <button class="buy-mode-btn" data-mode="10">Buy Ã—10</button>
        <button class="buy-mode-btn" data-mode="100">Buy Ã—100</button>
      </div>
      <div id="shopList"></div>
    </div>
    <div id="upgradesTab" class="tab-content">
      <h2 style="margin-top: 0; color: #d4a574;">Upgrades</h2>
      <div id="upgradesList" class="achievements-grid"></div>
    </div>
    <div id="prestigeTab" class="tab-content">
      <h2 style="margin-top: 0; color: #d4a574;">Prestige</h2>
      <div id="prestigeContent"></div>
    </div>
    <div id="achievementsTab" class="tab-content">
      <h2 style="margin-top: 0; color: #d4a574;">Achievements</h2>
      <div id="achievementsList" class="achievements-grid"></div>
    </div>
  </div>
</main>

<div id="achievementModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title" id="modalTitle">Achievement Pack</div>
      <button class="modal-close" id="closeAchievementModal">Ã—</button>
    </div>
    <div class="modal-achievements" id="modalAchievements"></div>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GAME STATE & INITIALIZATION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

let activeNotifications = [];
let notificationIdCounter = 0;
let notificationTimers = new Map();

const gameState = {
  coffee: 0,
  totalCoffeeAllTime: 0,
  clickPower: 1,
  goldenCoffee: 0,
  prestigeMultiplier: 1.0,
  items: {},
  purchasedUpgrades: new Set(),
  itemMultipliers: {},
  viewedUpgrades: new Set(),
  viewedAchievements: new Set(),
  achievements: [],
  collapsedPacks: new Set(),
  unclaimedAchievements: new Set(),
  displayCoffee: 0,
  displayCPS: 0,
  targetCoffee: 0,
  targetCPS: 0,
  buyMode: 1 // Ã—1, Ã—10, Ã—100
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHOP ITEMS
   v1.10: Added 8 new high-tier buildings
   Building Buff Formula: Items from Coffee Grinder onwards get 2Ã—-5Ã— multipliers
   CPS Scaling: Designed to reach ~10 quintillion (1e19) at high levels
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

const shopItems = [
  { id: 'brewer', name: 'Auto Brewer', baseCost: 50, cps: 5, scale: 1.15 },
  { id: 'barista', name: 'Barista', baseCost: 500, cps: 10, scale: 1.15 },
  // Buffed 2Ã— from original
  { id: 'grinder', name: 'Coffee Grinder', baseCost: 5000, cps: 100, scale: 1.2 },
  // Buffed 2Ã— from original
  { id: 'espresso', name: 'Espresso Machine', baseCost: 50000, cps: 500, scale: 1.2 },
  // Buffed 2Ã— from original
  { id: 'truck', name: 'Coffee Truck', baseCost: 200000, cps: 2000, scale: 1.25 },
  // Buffed 3Ã— from original
  { id: 'factory', name: 'Coffee Factory', baseCost: 1000000, cps: 30000, scale: 1.25 },
  // Buffed 4Ã— from original
  { id: 'corporation', name: 'Coffee Corporation', baseCost: 8000000, cps: 400000, scale: 1.3 },
  // Buffed 5Ã— from original
  { id: 'franchise', name: 'Coffee Franchise', baseCost: 50000000, cps: 5000000, scale: 1.3 },
  // New high-tier buildings
  { id: 'planet', name: 'Coffee Planet', baseCost: 500000000, cps: 50000000, scale: 1.35 },
  { id: 'solarsystem', name: 'Coffee Solar System', baseCost: 5000000000, cps: 500000000, scale: 1.35 },
  { id: 'galaxy', name: 'Coffee Galaxy', baseCost: 75000000000, cps: 7500000000, scale: 1.4 },
  { id: 'universe', name: 'Coffee Universe', baseCost: 1000000000000, cps: 100000000000, scale: 1.4 },
  { id: 'continent', name: 'Coffee Continent', baseCost: 15000000000000, cps: 1500000000000, scale: 1.45 },
  { id: 'country', name: 'Coffee Country', baseCost: 250000000000000, cps: 25000000000000, scale: 1.45 },
  { id: 'dimension', name: 'Coffee Dimension', baseCost: 5000000000000000, cps: 500000000000000, scale: 1.5 },
  { id: 'multiverse', name: 'Coffee Multiverse', baseCost: 100000000000000000, cps: 10000000000000000, scale: 1.5 }
];

// Initialize all items in gameState
shopItems.forEach(item => {
  if (!gameState.items[item.id]) {
    gameState.items[item.id] = { count: 0, cost: item.baseCost };
  }
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UPGRADES SYSTEM
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

const upgrades = [
  // Click Power Upgrades
  { 
    id: 'click_1', 
    name: 'Better Coffee Beans', 
    description: '+1 coffee per click', 
    cost: 1500, 
    effect: () => { gameState.clickPower += 1; },
    unlockCondition: () => gameState.totalCoffeeAllTime >= 1000,
    pack: 'click-power'
  },
  { 
    id: 'click_2', 
    name: 'Premium Coffee Beans', 
    description: '+2 coffee per click', 
    cost: 15000, 
    effect: () => { gameState.clickPower += 2; },
    unlockCondition: () => gameState.totalCoffeeAllTime >= 10000,
    pack: 'click-power'
  },
  { 
    id: 'click_3', 
    name: 'Exotic Coffee Beans', 
    description: '+5 coffee per click', 
    cost: 150000, 
    effect: () => { gameState.clickPower += 5; },
    unlockCondition: () => gameState.totalCoffeeAllTime >= 100000,
    pack: 'click-power'
  }
];

// Generate upgrades for all shop items (8 tiers each)
shopItems.forEach(item => {
  const tierCosts = [
    item.baseCost * 10,
    item.baseCost * 100,
    item.baseCost * 1000,
    item.baseCost * 10000,
    item.baseCost * 100000,
    item.baseCost * 1000000,
    item.baseCost * 10000000,
    item.baseCost * 100000000
  ];
  
  const tierRequirements = [10, 25, 50, 100, 200, 400, 700, 1000];
  const tierNames = [
    'Upgraded', 'Advanced', 'Industrial', 'Quantum', 
    'Hyper', 'Ultra', 'Mega', 'Divine'
  ];
  
  for (let i = 0; i < 8; i++) {
    upgrades.push({
      id: `${item.id}_${i + 1}`,
      name: `${tierNames[i]} ${item.name}`,
      description: `${item.name}s produce 2Ã— coffee`,
      cost: tierCosts[i],
      effect: () => {
        gameState.itemMultipliers[item.id] = (gameState.itemMultipliers[item.id] || 1) * 2;
      },
      unlockCondition: () => (gameState.items[item.id]?.count || 0) >= tierRequirements[i],
      pack: item.id
    });
  }
});

// Global Upgrades
upgrades.push(
  { 
    id: 'global_1', 
    name: 'Efficient Operations', 
    description: 'All items produce 1.5Ã— coffee', 
    cost: 500000, 
    effect: () => { 
      shopItems.forEach(item => {
        gameState.itemMultipliers[item.id] = (gameState.itemMultipliers[item.id] || 1) * 1.5;
      });
    },
    unlockCondition: () => shopItems.every(item => (gameState.items[item.id]?.count || 0) >= 10),
    pack: 'global'
  },
  { 
    id: 'global_2', 
    name: 'Coffee Revolution', 
    description: 'All items produce 2Ã— coffee', 
    cost: 5000000, 
    effect: () => { 
      shopItems.forEach(item => {
        gameState.itemMultipliers[item.id] = (gameState.itemMultipliers[item.id] || 1) * 2;
      });
    },
    unlockCondition: () => shopItems.every(item => (gameState.items[item.id]?.count || 0) >= 25),
    pack: 'global'
  }
);

const upgradePacks = [
  { id: 'click-power', name: 'Click Power Upgrades', icon: 'ğŸ‘†', description: 'Increase coffee per click' },
  { id: 'brewer', name: 'Auto Brewer Upgrades', icon: 'â˜•', description: 'Boost Auto Brewer production' },
  { id: 'barista', name: 'Barista Upgrades', icon: 'ğŸ‘¨â€ğŸ³', description: 'Enhance Barista efficiency' },
  { id: 'grinder', name: 'Coffee Grinder Upgrades', icon: 'âš™ï¸', description: 'Improve Coffee Grinder output' },
  { id: 'espresso', name: 'Espresso Machine Upgrades', icon: 'ğŸ”§', description: 'Upgrade Espresso Machine power' },
  { id: 'truck', name: 'Coffee Truck Upgrades', icon: 'ğŸšš', description: 'Enhance Coffee Truck capabilities' },
  { id: 'factory', name: 'Coffee Factory Upgrades', icon: 'ğŸ­', description: 'Amplify Coffee Factory performance' },
  { id: 'corporation', name: 'Coffee Corporation Upgrades', icon: 'ğŸ¢', description: 'Expand Coffee Corporation reach' },
  { id: 'franchise', name: 'Coffee Franchise Upgrades', icon: 'ğŸŒŸ', description: 'Scale Coffee Franchise operations' },
  { id: 'planet', name: 'Coffee Planet Upgrades', icon: 'ğŸŒ', description: 'Enhance Coffee Planet production' },
  { id: 'solarsystem', name: 'Solar System Upgrades', icon: 'â˜€ï¸', description: 'Boost Solar System output' },
  { id: 'galaxy', name: 'Coffee Galaxy Upgrades', icon: 'ğŸŒŒ', description: 'Amplify Galaxy production' },
  { id: 'universe', name: 'Coffee Universe Upgrades', icon: 'ğŸŒ ', description: 'Maximize Universe efficiency' },
  { id: 'continent', name: 'Coffee Continent Upgrades', icon: 'ğŸ—ºï¸', description: 'Enhance Continent reach' },
  { id: 'country', name: 'Coffee Country Upgrades', icon: 'ğŸ³ï¸', description: 'Boost Country production' },
  { id: 'dimension', name: 'Coffee Dimension Upgrades', icon: 'ğŸ”®', description: 'Amplify Dimension power' },
  { id: 'multiverse', name: 'Coffee Multiverse Upgrades', icon: 'â™¾ï¸', description: 'Maximize Multiverse output' },
  { id: 'global', name: 'Global Upgrades', icon: 'ğŸŒ', description: 'Universal production multipliers' }
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACHIEVEMENTS SYSTEM
   v1.10: All achievements renamed with coffee puns
   New CPS Achievement Pack added
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

const achievements = [
  // Coffee Collection Milestones (with puns!)
  { id: 'first', name: 'First Sip', requirement: 'Brew 1 coffee', condition: () => gameState.totalCoffeeAllTime >= 1, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/1", percent: () => Math.min(gameState.totalCoffeeAllTime / 1 * 100, 100) || 0, reward: { type: 'coffee', value: 1 } },
  { id: 'ten', name: 'Decaf No More', requirement: 'Brew 10 coffees', condition: () => gameState.totalCoffeeAllTime >= 10, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/10", percent: () => Math.min(gameState.totalCoffeeAllTime / 10 * 100, 100) || 0, reward: { type: 'coffee', value: 5 } },
  { id: 'hundred', name: 'Cent-imental Value', requirement: 'Brew 100 coffees', condition: () => gameState.totalCoffeeAllTime >= 100, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/100", percent: () => Math.min(gameState.totalCoffeeAllTime / 100 * 100, 100) || 0, reward: { type: 'coffee', value: 50 } },
  { id: 'thousand', name: 'Grand Grinder', requirement: 'Brew 1,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 1000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/1,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 1000 * 100, 100) || 0, reward: { type: 'coffee', value: 500 } },
  { id: 'tenk', name: 'Bean Counter', requirement: 'Brew 10,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 10000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/10,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 10000 * 100, 100) || 0, reward: { type: 'coffee', value: 5000 } },
  { id: 'hundredk', name: 'Latte Legend', requirement: 'Brew 100,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 100000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/100,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 100000 * 100, 100) || 0, reward: { type: 'coffee', value: 50000 } },
  { id: 'million', name: 'Mocha Millionaire', requirement: 'Brew 1,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 1000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/1,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 1000000 * 100, 100) || 0, reward: { type: 'coffee', value: 500000 } },
  { id: 'tenmill', name: 'Espresso Excess', requirement: 'Brew 10,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 10000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/10,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 10000000 * 100, 100) || 0, reward: { type: 'coffee', value: 5000000 } },
  { id: 'hundredmill', name: 'Brew Tycoon', requirement: 'Brew 100,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 100000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/100,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 100000000 * 100, 100) || 0, reward: { type: 'coffee', value: 50000000 } },
  { id: 'billion', name: 'Cappuccino Kingpin', requirement: 'Brew 1,000,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 1000000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/1,000,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 1000000000 * 100, 100) || 0, reward: { type: 'coffee', value: 500000000 } },
  { id: 'tenb', name: 'Drip Drop Titan', requirement: 'Brew 10,000,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 10000000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/10,000,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 10000000000 * 100, 100) || 0, reward: { type: 'coffee', value: 5000000000 } },
  { id: 'hundredb', name: 'Macchiato Master', requirement: 'Brew 100,000,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 100000000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/100,000,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 100000000000 * 100, 100) || 0, reward: { type: 'coffee', value: 50000000000 } },
  { id: 'trillion', name: 'French Press Phenom', requirement: 'Brew 1,000,000,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 1000000000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/1,000,000,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 1000000000000 * 100, 100) || 0, reward: { type: 'coffee', value: 500000000000 } },
  { id: 'tentr', name: 'Percolator Prodigy', requirement: 'Brew 10,000,000,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 10000000000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/10,000,000,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 10000000000000 * 100, 100) || 0, reward: { type: 'coffee', value: 5000000000000 } },
  { id: 'hundredtr', name: 'Americano Overlord', requirement: 'Brew 100,000,000,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 100000000000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/100,000,000,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 100000000000000 * 100, 100) || 0, reward: { type: 'coffee', value: 50000000000000 } },
  { id: 'quadrillion', name: 'Ristretto Royalty', requirement: 'Brew 1,000,000,000,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 1000000000000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/1,000,000,000,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 1000000000000000 * 100, 100) || 0, reward: { type: 'coffee', value: 500000000000000 } },
  { id: 'tenq', name: 'Affogato Architect', requirement: 'Brew 10,000,000,000,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 10000000000000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/10,000,000,000,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 10000000000000000 * 100, 100) || 0, reward: { type: 'coffee', value: 5000000000000000 } },
  { id: 'hundredq', name: 'Cortado Commander', requirement: 'Brew 100,000,000,000,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 100000000000000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/100,000,000,000,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 100000000000000000 * 100, 100) || 0, reward: { type: 'coffee', value: 50000000000000000 } },
  { id: 'quintillion', name: 'Lungo Luminary', requirement: 'Brew 1,000,000,000,000,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 1000000000000000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/1,000,000,000,000,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 1000000000000000000 * 100, 100) || 0, reward: { type: 'coffee', value: 500000000000000000 } },
  
  // Item Collection Achievements (with puns!)
  { id: 'first_item', name: 'Bean There', requirement: 'Purchase your first item', condition: () => Object.values(gameState.items).some(i => (i?.count ?? 0) >= 1), earned: false, progress: () => Object.values(gameState.items).some(i => (i?.count ?? 0) >= 1) ? "1/1" : "0/1", percent: () => Object.values(gameState.items).some(i => (i?.count ?? 0) >= 1) ? 100 : 0, reward: { type: 'coffee', value: 50 } },
  { id: 'five_any', name: 'Done That', requirement: 'Have 5 of any single item', condition: () => Object.values(gameState.items).some(i => (i?.count ?? 0) >= 5), earned: false, progress: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return max + "/5";
  }, percent: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return Math.min(max / 5 * 100, 100) || 0;
  }, reward: { type: 'coffee', value: 3 } }
];

// Generate item-specific milestones with puns
const itemMilestones = [10, 50, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000, 1500, 2000, 2500, 3000, 3500, 4000, 4500, 5000];
shopItems.forEach(item => {
  itemMilestones.forEach((milestone, idx) => {
    const multiplier = 1.025 + (idx * 0.025);
    achievements.push({
      id: `${item.id}_${milestone}`,
      name: `${item.name} ${milestone >= 1000 ? (milestone/1000).toFixed(0) + 'K' : milestone}`,
      requirement: `Own ${milestone.toLocaleString()} ${item.name}${milestone > 1 ? 's' : ''}`,
      condition: () => (gameState.items[item.id]?.count || 0) >= milestone,
      earned: false,
      progress: () => (gameState.items[item.id]?.count || 0) + "/" + milestone.toLocaleString(),
      percent: () => Math.min((gameState.items[item.id]?.count || 0) / milestone * 100, 100) || 0,
      reward: { type: 'multiplier', value: multiplier, itemId: item.id }
    });
  });
});

// CPS Achievement Pack (v1.10 NEW!)
const cpsMilestones = [
  { value: 1, name: 'Slow Drip' },
  { value: 10, name: 'Gentle Pour' },
  { value: 100, name: 'Steady Stream' },
  { value: 1000, name: 'A Latte Speed' },
  { value: 10000, name: 'Espresso Express' },
  { value: 100000, name: 'Turbo Brew' },
  { value: 1000000, name: 'Mega Percolator' },
  { value: 10000000, name: 'Hyper Grinder' },
  { value: 100000000, name: 'Ultra Drip' },
  { value: 1000000000, name: 'Giga Bean' },
  { value: 10000000000, name: 'Tera Roast' },
  { value: 100000000000, name: 'Peta Press' },
  { value: 1000000000000, name: 'Exa Pour' },
  { value: 10000000000000, name: 'Zetta Caffeine' },
  { value: 100000000000000, name: 'Yotta Extraction' },
  { value: 1000000000000000, name: 'Quantum Percolator' },
  { value: 10000000000000000, name: 'Cosmic Espresso' },
  { value: 100000000000000000, name: 'Universal Brew' },
  { value: 1000000000000000000, name: 'Multiversal Mocha' },
  { value: 10000000000000000000, name: 'Infinite Latte' }
];

cpsMilestones.forEach((milestone) => {
  achievements.push({
    id: `cps_${milestone.value}`,
    name: milestone.name,
    requirement: `Reach ${abbreviateNumber(milestone.value)} CPS`,
    condition: () => calculateTotalCPS() >= milestone.value,
    earned: false,
    progress: () => abbreviateNumber(calculateTotalCPS()) + "/" + abbreviateNumber(milestone.value),
    percent: () => Math.min(calculateTotalCPS() / milestone.value * 100, 100) || 0,
    reward: { type: 'coffee', value: milestone.value * 100 }
  });
});

// Upgrade Collection Achievements
for (let i = 10; i <= 100; i += 10) {
  achievements.push({
    id: `upgrades_${i}`,
    name: `Upgrade ${i}% Club`,
    requirement: `Purchase ${i}% of all upgrades`,
    condition: () => {
      const totalUpgrades = upgrades.length;
      const purchasedCount = gameState.purchasedUpgrades.size;
      return (purchasedCount / totalUpgrades * 100) >= i;
    },
    earned: false,
    progress: () => {
      const totalUpgrades = upgrades.length;
      const purchasedCount = gameState.purchasedUpgrades.size;
      const percent = Math.floor(purchasedCount / totalUpgrades * 100);
      return `${percent}%/${i}%`;
    },
    percent: () => {
      const totalUpgrades = upgrades.length;
      const purchasedCount = gameState.purchasedUpgrades.size;
      const currentPercent = (purchasedCount / totalUpgrades * 100);
      return Math.min(currentPercent / i * 100, 100) || 0;
    },
    reward: { type: 'coffee', value: i * 10000 }
  });
}

gameState.achievements = achievements;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILITY FUNCTIONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function abbreviateNumber(num) {
  if (num < 1000) return Math.floor(num).toString();
  if (num < 1000000) return (num / 1000).toFixed(1).replace(/\.0$/, '') + 'k';
  if (num < 1000000000) return (num / 1000000).toFixed(1).replace(/\.0$/, '') + 'M';
  if (num < 1000000000000) return (num / 1000000000).toFixed(1).replace(/\.0$/, '') + 'B';
  if (num < 1000000000000000) return (num / 1000000000000).toFixed(1).replace(/\.0$/, '') + 'T';
  if (num < 1000000000000000000) return (num / 1000000000000000).toFixed(1).replace(/\.0$/, '') + 'Q';
  return (num / 1000000000000000000).toFixed(1).replace(/\.0$/, '') + 'Qi';
}

function calculateTotalCPS() {
  let totalCPS = 0;
  shopItems.forEach(item => {
    if (!gameState.items[item.id]) {
      gameState.items[item.id] = { count: 0, cost: item.baseCost };
    }
    const itemState = gameState.items[item.id];
    const multiplier = gameState.itemMultipliers[item.id] || 1;
    const count = itemState.count ?? 0;
    totalCPS += item.cps * count * multiplier;
  });
  return totalCPS * gameState.prestigeMultiplier;
}

function calculateItemCPS(item) {
  const multiplier = gameState.itemMultipliers[item.id] || 1;
  return item.cps * multiplier * gameState.prestigeMultiplier;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BULK BUY CALCULATION
   v1.10: Geometric series formula for bulk purchasing
   Cost = baseCost Ã— (scale^count) Ã— (scale^amount - 1) / (scale - 1)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function calculateBulkCost(item, currentCount, amount) {
  const { baseCost, scale } = item;
  // Geometric series: a Ã— (r^n - 1) / (r - 1) where a = first term, r = scale, n = amount
  const firstCost = baseCost * Math.pow(scale, currentCount);
  const totalCost = firstCost * (Math.pow(scale, amount) - 1) / (scale - 1);
  return Math.floor(totalCost);
}

function calculateAffordableAmount(item, currentCount, maxAmount, availableCoffee) {
  let affordable = 0;
  for (let i = 1; i <= maxAmount; i++) {
    const cost = calculateBulkCost(item, currentCount, i);
    if (cost <= availableCoffee) {
      affordable = i;
    } else {
      break;
    }
  }
  return affordable;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SELL CALCULATION
   v1.10: Sell items for 50% of current cost
   Refund Formula: floor(baseCost Ã— scale^(count-1)) Ã— 0.5
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function calculateSellValue(item, currentCount) {
  if (currentCount <= 0) return 0;
  const { baseCost, scale } = item;
  // Current cost would be for buying the next one: baseCost Ã— scale^count
  // So we refund 50% of the cost for the last one bought: baseCost Ã— scale^(count-1)
  const lastCost = baseCost * Math.pow(scale, currentCount - 1);
  return Math.floor(lastCost * 0.5);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROGRESSIVE UNLOCKING
   v1.10: Items appear when player can afford â‰¥50% of base cost
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function isItemUnlocked(item) {
  const itemState = gameState.items[item.id];
  const hasOwned = (itemState?.count ?? 0) > 0;
  const canAfford50Percent = gameState.coffee >= (item.baseCost * 0.5);
  return hasOwned || canAfford50Percent;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NOTIFICATION SYSTEM
   v1.10: Fixed duplicate notifications, improved claim messages
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function showNotification(title, message, type = 'default', metadata = {}) {
  const container = document.getElementById('notificationContainer');
  const notifId = notificationIdCounter++;
  
  const notif = document.createElement('div');
  notif.className = 'notification';
  notif.dataset.notifId = notifId;
  
  if (type === 'achievement') {
    notif.classList.add('achievement-notif');
    notif.dataset.achievementId = metadata.achievementId || '';
  } else if (type === 'upgrade') {
    notif.classList.add('upgrade-notif');
    notif.dataset.packId = metadata.packId || '';
  }
  
  notif.innerHTML = `
    <div class="notification-title">${title}</div>
    <div class="notification-message">${message}</div>
  `;
  
  container.appendChild(notif);
  activeNotifications.push(notif);
  
  updateNotificationPositions();
  
  const timer = setTimeout(() => {
    removeNotificationNow(notif);
  }, 3000);
  notificationTimers.set(notif, timer);
  
  return notifId;
}

function updateNotificationPositions() {
  activeNotifications.forEach((notif, i) => {
    notif.style.transform = `translateY(${i * 10}px)`;
  });
}

function showPurchaseNotification(itemName) {
  const container = document.getElementById('notificationContainer');
  
  const existing = activeNotifications.find(n => 
    n.dataset.itemName === itemName && 
    n.classList.contains('purchase-notif')
  );
  
  if (existing) {
    const messageEl = existing.querySelector('.notification-message');
    const match = messageEl.textContent.match(/x(\d+)/);
    const count = match ? parseInt(match[1]) + 1 : 2;
    
    messageEl.textContent = `Purchased x${count} ${itemName}`;
    existing.dataset.count = count;
    
    const oldTimer = notificationTimers.get(existing);
    if (oldTimer) clearTimeout(oldTimer);
    
    const newTimer = setTimeout(() => {
      removeNotificationNow(existing);
    }, 4000);
    notificationTimers.set(existing, newTimer);
    
    existing.style.transform = 'scale(1.02)';
    setTimeout(() => {
      existing.style.transform = '';
      updateNotificationPositions();
    }, 150);
    
    return;
  }
  
  const notifId = notificationIdCounter++;
  const notif = document.createElement('div');
  notif.className = 'notification purchase-notif';
  notif.dataset.notifId = notifId;
  notif.dataset.itemName = itemName;
  notif.dataset.count = 1;
  
  notif.innerHTML = `
    <div class="notification-title">Purchase Complete</div>
    <div class="notification-message">${itemName}</div>
  `;
  
  container.appendChild(notif);
  activeNotifications.push(notif);
  
  updateNotificationPositions();
  
  const timer = setTimeout(() => {
    removeNotificationNow(notif);
  }, 4000);
  notificationTimers.set(notif, timer);
}

function showClaimNotification(achievementName) {
  const container = document.getElementById('notificationContainer');
  
  const notifId = notificationIdCounter++;
  const notif = document.createElement('div');
  notif.className = 'notification purchase-notif';
  notif.dataset.notifId = notifId;
  notif.dataset.itemName = achievementName;
  
  notif.innerHTML = `
    <div class="notification-title">Achievement Claimed!</div>
    <div class="notification-message">${achievementName}</div>
  `;
  
  container.appendChild(notif);
  activeNotifications.push(notif);
  
  updateNotificationPositions();
  
  const timer = setTimeout(() => {
    removeNotificationNow(notif);
  }, 4000);
  notificationTimers.set(notif, timer);
}

function removeNotificationNow(notificationElement) {
  if (!notificationElement || !notificationElement.parentNode) return;
  
  const timer = notificationTimers.get(notificationElement);
  if (timer) {
    clearTimeout(timer);
    notificationTimers.delete(notificationElement);
  }
  
  activeNotifications = activeNotifications.filter(n => n !== notificationElement);
  
  notificationElement.classList.add('fade-out');
  
  updateNotificationPositions();
  
  setTimeout(() => {
    if (notificationElement.parentNode) {
      notificationElement.remove();
    }
  }, 300);
}

function removeNotificationsByAchievement(achievementId) {
  const toRemove = activeNotifications.filter(n => n.dataset.achievementId === achievementId);
  toRemove.forEach(n => removeNotificationNow(n));
}

function removeNotificationsByPack(packId) {
  const toRemove = activeNotifications.filter(n => n.dataset.packId === packId);
  toRemove.forEach(n => removeNotificationNow(n));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACHIEVEMENT FUNCTIONS
   v1.10: Fixed claim text to say "Claimed" instead of "Purchase"
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function claimAchievementReward(achievement) {
  if (!achievement.reward || !gameState.unclaimedAchievements.has(achievement.id)) return '';
  
  gameState.unclaimedAchievements.delete(achievement.id);
  gameState.viewedAchievements.add(achievement.id);
  
  removeNotificationsByAchievement(achievement.id);
  
  // v1.10: Show "Claimed" notification instead of "Purchase"
  showClaimNotification(achievement.name);
  
  if (achievement.reward.type === 'coffee') {
    gameState.coffee += achievement.reward.value;
    gameState.targetCoffee = gameState.coffee;
    saveGame();
    updateUI();
    return ` (+${abbreviateNumber(achievement.reward.value)} coffee!)`;
  } else if (achievement.reward.type === 'multiplier') {
    const itemId = achievement.reward.itemId;
    gameState.itemMultipliers[itemId] = (gameState.itemMultipliers[itemId] || 1) * achievement.reward.value;
    const itemName = shopItems.find(i => i.id === itemId)?.name;
    const multiplierPercent = ((achievement.reward.value - 1) * 100).toFixed(1);
    saveGame();
    updateUI();
    return ` (+${multiplierPercent}% ${itemName} production!)`;
  }
  
  return '';
}

function getRewardText(reward) {
  if (reward.type === 'coffee') {
    return `Reward: ${abbreviateNumber(reward.value)} Coffee`;
  } else if (reward.type === 'multiplier') {
    const itemName = shopItems.find(i => i.id === reward.itemId)?.name;
    const multiplierPercent = ((reward.value - 1) * 100).toFixed(1);
    return `Reward: +${multiplierPercent}% ${itemName} production`;
  }
  return '';
}

function getVisibleAchievements(achievementList) {
  const visible = [];
  for (let i = 0; i < achievementList.length; i++) {
    const achievement = achievementList[i];
    if (achievement.earned) {
      visible.push(achievement);
    } else {
      const previousEarned = i === 0 || achievementList[i - 1].earned;
      if (previousEarned) {
        visible.push(achievement);
      }
      break;
    }
  }
  return visible;
}

function getAchievementPacks() {
  const packs = [
    {
      id: 'coffee_milestones',
      title: 'Coffee Milestones',
      description: 'Achievements for brewing coffee',
      icon: 'â˜•',
      achievements: achievements.filter(a => 
        ['first', 'ten', 'hundred', 'thousand', 'tenk', 'hundredk', 
         'million', 'tenmill', 'hundredmill', 'billion', 'tenb', 'hundredb',
         'trillion', 'tentr', 'hundredtr', 'quadrillion', 'tenq', 'hundredq', 'quintillion'].includes(a.id)
      )
    },
    {
      id: 'cps_milestones',
      title: 'CPS Milestones',
      description: 'Achievements for coffee per second',
      icon: 'âš¡',
      achievements: achievements.filter(a => a.id.startsWith('cps_'))
    },
    {
      id: 'general_collection',
      title: 'General Collection',
      description: 'Achievements for collecting any items',
      icon: 'ğŸ“¦',
      achievements: achievements.filter(a => 
        a.id.includes('_item') || 
        a.id.includes('_any')
      )
    },
    {
      id: 'upgrade_collection',
      title: 'Upgrade Collection',
      description: 'Achievements for purchasing upgrades',
      icon: 'â¬†ï¸',
      achievements: achievements.filter(a => a.id.startsWith('upgrades_'))
    }
  ];
  
  shopItems.forEach(item => {
    const itemAchievements = achievements.filter(a => a.id.startsWith(item.id + '_') && !a.id.includes('_any'));
    if (itemAchievements.length > 0) {
      packs.push({
        id: item.id + '_pack',
        title: `${item.name} Collection`,
        description: `Achievements for owning ${item.name}s`,
        icon: 'ğŸ†',
        achievements: itemAchievements
      });
    }
  });
  
  return packs;
}

function checkAchievements() {
  const currentTab = document.querySelector('.tab-btn.active')?.dataset.tab;
  
  gameState.achievements.forEach(a => {
    if (a.condition() && !a.earned) {
      a.earned = true;
      gameState.unclaimedAchievements.add(a.id);
      
      // v1.10: Only show notification if NOT on achievements tab to prevent duplicates
      if (currentTab !== 'achievements') {
        showNotification(
          'Achievement Unlocked!',
          `${a.name}`,
          'achievement',
          { achievementId: a.id }
        );
      }
      
      saveGame();
    }
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SAVE/LOAD SYSTEM
   v1.10: Maintains compatibility with v1.9 saves, adds safe defaults
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function saveGame() {
  const saveData = {
    coffee: gameState.coffee,
    totalCoffeeAllTime: gameState.totalCoffeeAllTime,
    clickPower: gameState.clickPower,
    goldenCoffee: gameState.goldenCoffee,
    prestigeMultiplier: gameState.prestigeMultiplier,
    items: gameState.items,
    purchasedUpgrades: Array.from(gameState.purchasedUpgrades),
    itemMultipliers: gameState.itemMultipliers,
    viewedUpgrades: Array.from(gameState.viewedUpgrades),
    viewedAchievements: Array.from(gameState.viewedAchievements),
    achievements: gameState.achievements.map(a => ({ id: a.id, earned: a.earned })),
    collapsedPacks: Array.from(gameState.collapsedPacks),
    unclaimedAchievements: Array.from(gameState.unclaimedAchievements),
    buyMode: gameState.buyMode // v1.10: Save buy mode
  };
  localStorage.setItem('coffeeTycoonSave', JSON.stringify(saveData));
}

function loadGame() {
  const saved = localStorage.getItem('coffeeTycoonSave');
  if (saved) {
    try {
      const data = JSON.parse(saved);
      gameState.coffee = data.coffee || 0;
      gameState.totalCoffeeAllTime = data.totalCoffeeAllTime || 0;
      gameState.clickPower = data.clickPower || 1;
      gameState.goldenCoffee = data.goldenCoffee || 0;
      gameState.prestigeMultiplier = data.prestigeMultiplier || 1.0;
      gameState.items = data.items || {};
      gameState.purchasedUpgrades = new Set(data.purchasedUpgrades || []);
      gameState.itemMultipliers = data.itemMultipliers || {};
      gameState.viewedUpgrades = new Set(data.viewedUpgrades || []);
      gameState.viewedAchievements = new Set(data.viewedAchievements || []);
      gameState.collapsedPacks = new Set(data.collapsedPacks || []);
      gameState.unclaimedAchievements = new Set(data.unclaimedAchievements || []);
      gameState.buyMode = data.buyMode || 1; // v1.10: Load buy mode, default to 1
      
      // v1.10: Initialize new items that didn't exist in old saves
      shopItems.forEach(item => {
        if (!gameState.items[item.id]) {
          gameState.items[item.id] = { count: 0, cost: item.baseCost };
        }
      });
      
      // Load achievement states
      if (data.achievements) {
        data.achievements.forEach(savedAch => {
          const ach = gameState.achievements.find(a => a.id === savedAch.id);
          if (ach) ach.earned = savedAch.earned;
        });
      }
      
      return true;
    } catch (e) {
      console.error('Error loading save:', e);
      return false;
    }
  }
  return false;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CORE GAME ACTIONS
   v1.10: Buy, Sell, and Upgrade functions with bulk support
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function buyItem(itemId) {
  const shopItem = shopItems.find(i => i.id === itemId);
  if (!shopItem) return;
  
  if (!gameState.items[itemId]) {
    gameState.items[itemId] = { count: 0, cost: shopItem.baseCost };
  }
  
  const itemState = gameState.items[itemId];
  const currentCount = itemState.count ?? 0;
  const amount = gameState.buyMode;
  
  // Calculate actual affordable amount
  const affordableAmount = calculateAffordableAmount(shopItem, currentCount, amount, gameState.coffee);
  
  if (affordableAmount === 0) return;
  
  const totalCost = calculateBulkCost(shopItem, currentCount, affordableAmount);
  
  if (gameState.coffee >= totalCost) {
    gameState.coffee -= totalCost;
    itemState.count = currentCount + affordableAmount;
    
    // Update cost for next purchase
    itemState.cost = Math.floor(shopItem.baseCost * Math.pow(shopItem.scale, itemState.count));
    
    // Show notification
    if (affordableAmount > 1) {
      showPurchaseNotification(`Bought ${affordableAmount}Ã— ${shopItem.name}`);
    } else {
      showPurchaseNotification(shopItem.name);
    }
    
    saveGame();
    updateUI();
  }
}

function sellItem(itemId) {
  const shopItem = shopItems.find(i => i.id === itemId);
  if (!shopItem) return;
  
  const itemState = gameState.items[itemId];
  if (!itemState || itemState.count <= 0) return;
  
  const refundValue = calculateSellValue(shopItem, itemState.count);
  
  gameState.coffee += refundValue;
  itemState.count -= 1;
  
  // Update cost for next purchase
  itemState.cost = Math.floor(shopItem.baseCost * Math.pow(shopItem.scale, itemState.count));
  
  showPurchaseNotification(`Sold 1Ã— ${shopItem.name}`);
  
  saveGame();
  updateUI();
}

function buyUpgrade(upgradeId) {
  const upgrade = upgrades.find(u => u.id === upgradeId);
  if (!upgrade || gameState.purchasedUpgrades.has(upgradeId)) return;
  
  if (gameState.coffee >= upgrade.cost) {
    gameState.coffee -= upgrade.cost;
    gameState.purchasedUpgrades.add(upgradeId);
    gameState.viewedUpgrades.add(upgradeId);
    upgrade.effect();
    
    const packId = upgrade.pack;
    if (packId) {
      removeNotificationsByPack(packId);
    }
    
    showPurchaseNotification(upgrade.name);
    
    saveGame();
    updateUI();
  }
}

function doPrestige() {
  const goldenCoffeeToGain = Math.floor(gameState.totalCoffeeAllTime / 10000000000);
  if (goldenCoffeeToGain > gameState.goldenCoffee) {
    const gained = goldenCoffeeToGain - gameState.goldenCoffee;
    if (confirm(`Prestige and gain ${gained} Golden Coffee?\n\nThis will reset:\nâ€¢ Coffee count\nâ€¢ All items\nâ€¢ All upgrades\n\nYou will keep:\nâ€¢ Golden Coffee\nâ€¢ ${(goldenCoffeeToGain * 10)}% production multiplier\nâ€¢ All achievements`)) {
      gameState.goldenCoffee = goldenCoffeeToGain;
      gameState.prestigeMultiplier = 1 + (gameState.goldenCoffee * 0.1);
      
      gameState.coffee = 0;
      gameState.clickPower = 1;
      gameState.purchasedUpgrades = new Set();
      gameState.itemMultipliers = {};
      
      shopItems.forEach(item => {
        gameState.items[item.id] = { count: 0, cost: item.baseCost };
      });
      
      showPurchaseNotification(`Prestiged! Gained ${gained} Golden Coffee!`);
      saveGame();
      updateUI();
    }
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UI RENDERING FUNCTIONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

function updateNotificationBadges() {
  const availableUpgrades = upgrades.filter(u => 
    u.unlockCondition() && 
    !gameState.purchasedUpgrades.has(u.id) && 
    !gameState.viewedUpgrades.has(u.id)
  );
  const upgradesBtn = document.querySelector('[data-tab="upgrades"]');
  let upgradeBadge = upgradesBtn.querySelector('.notification-badge');
  if (availableUpgrades.length > 0 && !upgradeBadge) {
    upgradeBadge = document.createElement('div');
    upgradeBadge.className = 'notification-badge';
    upgradesBtn.appendChild(upgradeBadge);
  } else if (availableUpgrades.length === 0 && upgradeBadge) {
    upgradeBadge.remove();
  }
  
  const unclaimedCount = gameState.unclaimedAchievements.size;
  const achievementsBtn = document.querySelector('[data-tab="achievements"]');
  let achievementBadge = achievementsBtn.querySelector('.notification-badge');
  if (unclaimedCount > 0 && !achievementBadge) {
    achievementBadge = document.createElement('div');
    achievementBadge.className = 'notification-badge';
    achievementsBtn.appendChild(achievementBadge);
  } else if (unclaimedCount === 0 && achievementBadge) {
    achievementBadge.remove();
  }
}

function updateUI() {
  document.getElementById('coffeeDisplay').textContent = abbreviateNumber(gameState.displayCoffee);
  document.getElementById('cpsDisplay').textContent = abbreviateNumber(gameState.displayCPS);
  document.getElementById('goldenCoffeeDisplay').textContent = gameState.goldenCoffee;
  document.getElementById('clickPowerDisplay').textContent = gameState.clickPower;
  
  updateNotificationBadges();
  renderShop();
  renderUpgrades();
  renderPrestige();
  renderAchievements();
  checkAchievements();
}

function renderShop() {
  const container = document.getElementById('shopList');
  container.innerHTML = '';
  
  shopItems.forEach(item => {
    // v1.10: Progressive unlocking - only show if unlocked
    if (!isItemUnlocked(item)) return;
    
    if (!gameState.items[item.id]) {
      gameState.items[item.id] = { count: 0, cost: item.baseCost };
    }
    
    const itemState = gameState.items[item.id];
    const currentCount = itemState.count ?? 0;
    const amount = gameState.buyMode;
    
    // Calculate bulk cost
    const affordableAmount = calculateAffordableAmount(item, currentCount, amount, gameState.coffee);
    const totalCost = affordableAmount > 0 ? calculateBulkCost(item, currentCount, affordableAmount) : 
                      calculateBulkCost(item, currentCount, amount);
    const canAfford = affordableAmount > 0;
    
    const itemCPS = calculateItemCPS(item);
    const sellValue = calculateSellValue(item, currentCount);
    const canSell = currentCount > 0;
    
    const div = document.createElement('div');
    div.className = 'shop-item' + (canAfford ? ' affordable' : '');
    div.innerHTML = `
      <div class="item-info">
        <div class="item-name">${item.name}</div>
        <div class="item-effect">Effect: +${abbreviateNumber(itemCPS)} CPS each</div>
      </div>
      <div class="item-actions">
        <div class="quantity-display">${currentCount}</div>
        <button class="sell-btn" ${!canSell ? 'disabled' : ''}>
          SELL 1<br><span style="font-size: 0.8rem;">(${abbreviateNumber(sellValue)})</span>
        </button>
        <button class="buy-btn" ${!canAfford ? 'disabled' : ''}>
          BUY ${affordableAmount > 1 && affordableAmount < amount ? 'Ã—' + affordableAmount : amount > 1 ? 'Ã—' + amount : ''}
        </button>
        <div class="cost-tile">â˜• ${abbreviateNumber(totalCost)}</div>
      </div>
    `;
    
    div.querySelector('.buy-btn').onclick = () => buyItem(item.id);
    div.querySelector('.sell-btn').onclick = () => sellItem(item.id);
    container.appendChild(div);
  });
  
  if (container.children.length === 0) {
    container.innerHTML = '<div class="empty-state">No items available yet. Keep brewing coffee to unlock shop items!</div>';
  }
}

let previouslyUnlockedUpgrades = new Set();

function renderUpgrades() {
  const container = document.getElementById('upgradesList');
  container.innerHTML = '';
  container.className = 'achievements-grid';
  
  const currentTab = document.querySelector('.tab-btn.active')?.dataset.tab;
  
  upgradePacks.forEach(pack => {
    const packUpgrades = upgrades.filter(u => u.pack === pack.id);
    if (packUpgrades.length === 0) return;
    
    const unlockedUpgrades = packUpgrades.filter(u => u.unlockCondition());
    if (unlockedUpgrades.length === 0) return;
    
    const newlyUnlocked = unlockedUpgrades.filter(u => 
      !previouslyUnlockedUpgrades.has(u.id) && 
      !gameState.purchasedUpgrades.has(u.id)
    );
    
    if (newlyUnlocked.length > 0 && currentTab !== 'upgrades') {
      showNotification(
        'New Upgrades Available!',
        `${pack.name}: ${newlyUnlocked.length} upgrade${newlyUnlocked.length > 1 ? 's' : ''} unlocked`,
        'upgrade',
        { packId: pack.id }
      );
    }
    
    newlyUnlocked.forEach(u => previouslyUnlockedUpgrades.add(u.id));
    
    const purchasedUpgrades = packUpgrades.filter(u => gameState.purchasedUpgrades.has(u.id));
    const affordableUpgrades = unlockedUpgrades.filter(u => 
      !gameState.purchasedUpgrades.has(u.id) && 
      gameState.coffee >= u.cost
    );
    
    if (currentTab === 'upgrades') {
      unlockedUpgrades.forEach(u => {
        if (!gameState.purchasedUpgrades.has(u.id)) {
          gameState.viewedUpgrades.add(u.id);
        }
      });
    }
    
    const isCollapsed = gameState.collapsedPacks.has(pack.id);
    const progressPercent = packUpgrades.length > 0 ? Math.round((purchasedUpgrades.length / packUpgrades.length) * 100) : 0;
    
    const packDiv = document.createElement('div');
    packDiv.className = 'upgrade-pack';
    
    const previewUpgrades = unlockedUpgrades.slice(0, 8);
    packDiv.innerHTML = `
      <div class="upgrade-pack-header">
        <div class="upgrade-pack-title">
          <span>${pack.name}</span>
        </div>
      </div>
      <div class="upgrade-pack-description">${pack.description}</div>
      <div class="progress" style="margin-bottom: 12px;">
        <div class="progress-bar" style="width: ${progressPercent}%; background: #d4a574;"></div>
      </div>
      <div class="upgrade-pack-preview">
        ${previewUpgrades.map(u => {
          const purchased = gameState.purchasedUpgrades.has(u.id);
          const affordable = !purchased && gameState.coffee >= u.cost && u.unlockCondition();
          return `<span class="upgrade-pack-badge" ${affordable ? 'title="Affordable" aria-label="Affordable"' : ''}>${purchased ? 'âœ“' : (affordable ? '!' : 'â—‹')}</span>`;
        }).join('')}
        ${unlockedUpgrades.length > 8 ? '<span style="opacity: 0.6;">...</span>' : ''}
      </div>
      ${affordableUpgrades.length > 0 ? `<div style="color: #4CAF50; font-weight: 600; font-size: 0.9rem; margin-top: 8px;">${affordableUpgrades.length} affordable upgrade${affordableUpgrades.length !== 1 ? 's' : ''}</div>` : ''}
      <div class="upgrade-pack-toggle">${isCollapsed ? 'â–¼ Click to expand' : 'â–² Click to collapse'}</div>
    `;
    
    packDiv.onclick = (e) => {
      if (!e.target.closest('.upgrade-buy-btn')) {
        toggleUpgradePack(pack.id);
      }
    };
    
    const contentDiv = document.createElement('div');
    contentDiv.className = `upgrade-pack-content ${isCollapsed ? 'collapsed' : ''}`;
    
    unlockedUpgrades.forEach(upgrade => {
      const purchased = gameState.purchasedUpgrades.has(upgrade.id);
      const canAfford = gameState.coffee >= upgrade.cost && !purchased;
      
      const upgradeDiv = document.createElement('div');
      upgradeDiv.className = 'upgrade-item';
      if (canAfford) upgradeDiv.classList.add('affordable');
      if (purchased) upgradeDiv.classList.add('purchased');
      
      upgradeDiv.innerHTML = `
        <div class="upgrade-header">
          <div class="upgrade-name">${upgrade.name}</div>
          <div class="upgrade-status">${purchased ? 'âœ“ OWNED' : ''}</div>
        </div>
        <div class="upgrade-description">${upgrade.description}</div>
        <div class="upgrade-footer">
          <div class="cost-tile">â˜• ${abbreviateNumber(upgrade.cost)}</div>
          <button class="upgrade-buy-btn" ${!canAfford || purchased ? 'disabled' : ''}>
            ${purchased ? 'PURCHASED' : 'BUY UPGRADE'}
          </button>
        </div>
      `;
      
      if (!purchased) {
        upgradeDiv.querySelector('.upgrade-buy-btn').onclick = (e) => {
          e.stopPropagation();
          buyUpgrade(upgrade.id);
        };
      }
      
      contentDiv.appendChild(upgradeDiv);
    });
    
    packDiv.appendChild(contentDiv);
    container.appendChild(packDiv);
  });
  
  if (container.children.length === 0) {
    container.innerHTML = '<div class="empty-state">No upgrades available yet. Keep brewing coffee and purchasing items to unlock upgrades!</div>';
  }
}

function toggleUpgradePack(packId) {
  if (gameState.collapsedPacks.has(packId)) {
    gameState.collapsedPacks.delete(packId);
  } else {
    gameState.collapsedPacks.add(packId);
  }
  renderUpgrades();
  saveGame();
}

function renderPrestige() {
  const container = document.getElementById('prestigeContent');
  const goldenCoffeeToGain = Math.floor(gameState.totalCoffeeAllTime / 10000000000);
  const newMultiplier = 1 + (goldenCoffeeToGain * 0.1);
  const canPrestige = goldenCoffeeToGain > gameState.goldenCoffee;
  
  container.innerHTML = `
    <div class="prestige-container">
      <div class="prestige-info">
        <h3 style="color: #ffd700; font-size: 1.5rem; margin: 0 0 16px 0;">Golden Coffee System</h3>
        <p>Reset your progress to earn Golden Coffee for permanent production multipliers!</p>
        <div style="font-size: 2rem; font-weight: 700; color: #ffd700; margin: 16px 0;">
          Current Multiplier: ${gameState.prestigeMultiplier.toFixed(1)}x
        </div>
      </div>
      <div style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
        <p><strong>How it works:</strong></p>
        <p>â€¢ Every 10B total coffees = 1 Golden Coffee</p>
        <p>â€¢ Each Golden Coffee gives +10% production (permanent!)</p>
        <p>â€¢ Prestiging resets coffee, items, and upgrades</p>
        <p>â€¢ Golden Coffee and multiplier are kept forever</p>
      </div>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin: 20px 0;">
        <div style="background: rgba(255, 255, 255, 0.05); padding: 16px; border-radius: 12px;">
          <div style="opacity: 0.8; margin-bottom: 8px;">Total Coffee Brewed</div>
          <div style="font-size: 1.8rem; font-weight: 700; color: #ffd700;">${abbreviateNumber(gameState.totalCoffeeAllTime)}</div>
        </div>
        <div style="background: rgba(255, 255, 255, 0.05); padding: 16px; border-radius: 12px;">
          <div style="opacity: 0.8; margin-bottom: 8px;">Golden Coffee to Gain</div>
          <div style="font-size: 1.8rem; font-weight: 700; color: #ffd700;">${goldenCoffeeToGain}</div>
        </div>
      </div>
      ${canPrestige ? `
        <div style="text-align: center; font-size: 1.2rem; color: #4CAF50; font-weight: 600; margin: 12px 0;">
          You will gain ${goldenCoffeeToGain - gameState.goldenCoffee} Golden Coffee!
        </div>
        <div style="text-align: center; font-size: 1.2rem; color: #4CAF50; font-weight: 600; margin: 12px 0;">
          New Multiplier: ${newMultiplier.toFixed(1)}x (from ${gameState.prestigeMultiplier.toFixed(1)}x)
        </div>
      ` : `
        <div style="text-align: center; margin: 20px 0; font-size: 1.1rem; opacity: 0.8;">
          Need ${abbreviateNumber((gameState.goldenCoffee + 1) * 10000000000)} total coffees to prestige
          <br>Current: ${abbreviateNumber(gameState.totalCoffeeAllTime)}
        </div>
      `}
      <button class="prestige-button" ${!canPrestige ? 'disabled' : ''}>
        ${canPrestige ? 'PRESTIGE NOW' : 'Not Enough Coffee Yet'}
      </button>
    </div>
  `;
  
  const btn = container.querySelector('.prestige-button');
  if (canPrestige) {
    btn.onclick = doPrestige;
  }
}

function renderAchievements() {
  const container = document.getElementById('achievementsList');
  container.innerHTML = '';
  container.className = 'achievements-grid';
  
  const packs = getAchievementPacks();
  packs.forEach(pack => {
    const visibleAchievements = getVisibleAchievements(pack.achievements);
    
    if (visibleAchievements.length === 0) return;
    
    const earnedCount = pack.achievements.filter(a => a.earned).length;
    const totalCount = pack.achievements.length;
    const progressPercent = totalCount > 0 ? Math.round((earnedCount / totalCount) * 100) : 0;
    
    const unclaimedInPack = pack.achievements.filter(a => gameState.unclaimedAchievements.has(a.id)).length;
    
    const div = document.createElement('div');
    div.className = 'achievement-pack';
    
    const badgeHTML = unclaimedInPack > 0 ? `<div class="notification-badge">${unclaimedInPack}</div>` : '';
    
    div.innerHTML = `
      ${badgeHTML}
      <div class="pack-header">
        <div class="pack-title">${pack.title}</div>
      </div>
      <div class="pack-description">${pack.description}</div>
      <div class="progress" style="margin-bottom: 12px;">
        <div class="progress-bar" style="width: ${progressPercent}%; background: #4CAF50;"></div>
      </div>
      <div class="pack-preview">
        ${visibleAchievements.slice(0, 8).map(a => {
          const isUnclaimed = gameState.unclaimedAchievements.has(a.id);
          return `<span class="pack-badge">${a.earned ? (isUnclaimed ? '!' : 'âœ“') : 'â—‹'}</span>`;
        }).join('')}
        ${visibleAchievements.length > 8 ? '<span style="opacity: 0.6;">...</span>' : ''}
      </div>
    `;
    
    div.onclick = () => openAchievementModal(pack);
    container.appendChild(div);
  });
}

function openAchievementModal(pack) {
  const modal = document.getElementById('achievementModal');
  const modalTitle = document.getElementById('modalTitle');
  const modalAchievements = document.getElementById('modalAchievements');
  
  modalTitle.textContent = pack.title;
  modalAchievements.innerHTML = '';
  
  const visibleAchievements = getVisibleAchievements(pack.achievements);
  
  visibleAchievements.forEach(a => {
    const isUnclaimed = gameState.unclaimedAchievements.has(a.id);
    const isClaimed = a.earned && !isUnclaimed;
    
    const div = document.createElement('div');
    
    if (isUnclaimed) {
      div.className = 'modal-achievement unlocked unclaimed';
    } else if (isClaimed) {
      div.className = 'modal-achievement claimed';
    } else {
      div.className = 'modal-achievement';
    }
    
    div.innerHTML = `
      <div style="font-size: 1.1rem; font-weight: 700; margin-bottom: 4px;">
        ${a.earned ? (isUnclaimed ? '!' : 'âœ“') : 'â—‹'} ${a.name}
      </div>
      <div style="opacity: 0.9; margin-bottom: 8px; font-size: 0.9rem;">${a.requirement}</div>
      ${a.reward ? `<div class="achievement-reward">${getRewardText(a.reward)}${isUnclaimed ? ' - Click to claim!' : ''}</div>` : ''}
      <div class="progress">
        <div class="progress-bar" style="width: ${a.percent()}%; ${a.earned ? 'background: #4CAF50;' : ''}"></div>
      </div>
    `;
    
    if (isUnclaimed) {
      div.onclick = () => {
        claimAchievementReward(a);
        openAchievementModal(pack);
        renderAchievements();
      };
    }
    
    modalAchievements.appendChild(div);
  });
  
  modal.classList.remove('hidden');
}

function closeAchievementModal() {
  document.getElementById('achievementModal').classList.add('hidden');
}

function openVersionInfo() {
  document.getElementById('versionModal').classList.remove('hidden');
}

function closeVersionInfo() {
  document.getElementById('versionModal').classList.add('hidden');
}

function openHelp() {
  document.getElementById('instructionsOverlay').classList.remove('hidden');
}

function closeInstructions() {
  document.getElementById('instructionsOverlay').classList.add('hidden');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GAME LOOP & EVENT LISTENERS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

// Coffee button click
document.getElementById('coffeeButton').onclick = () => {
  const earned = gameState.clickPower * gameState.prestigeMultiplier;
  gameState.coffee += earned;
  gameState.totalCoffeeAllTime += earned;
  
  gameState.targetCoffee = gameState.coffee;
  
  const btn = document.getElementById('coffeeButton');
  btn.style.transform = 'scale(0.9)';
  setTimeout(() => btn.style.transform = 'scale(1)', 100);
};

// Smooth animation for display values
function smoothAnimate() {
  const lerpFactor = 0.15;
  
  const coffeeDiff = gameState.targetCoffee - gameState.displayCoffee;
  if (Math.abs(coffeeDiff) > 0.01) {
    gameState.displayCoffee += coffeeDiff * lerpFactor;
  } else {
    gameState.displayCoffee = gameState.targetCoffee;
  }
  
  const cpsDiff = gameState.targetCPS - gameState.displayCPS;
  if (Math.abs(cpsDiff) > 0.01) {
    gameState.displayCPS += cpsDiff * lerpFactor;
  } else {
    gameState.displayCPS = gameState.targetCPS;
  }
}

let lastRenderTime = Date.now();

// Main game tick (10 times per second)
setInterval(() => {
  const totalCPS = calculateTotalCPS();
  const coffeePerTick = totalCPS / 10;
  
  if (totalCPS > 0) {
    gameState.coffee += coffeePerTick;
    gameState.totalCoffeeAllTime += coffeePerTick;
    gameState.targetCoffee = gameState.coffee;
  }
  
  gameState.targetCPS = totalCPS;
  smoothAnimate();
  
  const now = Date.now();
  if (now - lastRenderTime > 16) {
    document.getElementById('coffeeDisplay').textContent = abbreviateNumber(gameState.displayCoffee);
    document.getElementById('cpsDisplay').textContent = abbreviateNumber(gameState.displayCPS);
    lastRenderTime = now;
  }
}, 100);

// UI update (once per second)
setInterval(() => {
  updateUI();
}, 1000);

// Auto-save (every 30 seconds)
setInterval(() => {
  saveGame();
}, 30000);

// Tab switching
document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.onclick = () => {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    
    btn.classList.add('active');
    const tabId = btn.dataset.tab + 'Tab';
    document.getElementById(tabId).classList.add('active');
    
    updateUI();
    saveGame();
  };
});

// Buy mode selector
document.querySelectorAll('.buy-mode-btn').forEach(btn => {
  btn.onclick = () => {
    document.querySelectorAll('.buy-mode-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    gameState.buyMode = parseInt(btn.dataset.mode);
    saveGame();
    renderShop();
  };
});

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
  const key = e.key;
  const tabs = ['brew', 'shop', 'upgrades', 'prestige', 'achievements'];
  const index = parseInt(key) - 1;
  
  if (index >= 0 && index < tabs.length) {
    const btn = document.querySelector(`[data-tab="${tabs[index]}"]`);
    if (btn) btn.click();
  }
});

// Modal controls
document.getElementById('helpBtn').onclick = openHelp;
document.getElementById('infoBtn').onclick = openVersionInfo;
document.getElementById('startGameBtn').onclick = closeInstructions;
document.getElementById('closeVersionModal').onclick = closeVersionInfo;
document.getElementById('closeAchievementModal').onclick = closeAchievementModal;

document.getElementById('achievementModal').onclick = (e) => {
  if (e.target.id === 'achievementModal') {
    closeAchievementModal();
  }
};

document.getElementById('versionModal').onclick = (e) => {
  if (e.target.id === 'versionModal') {
    closeVersionInfo();
  }
};

document.getElementById('instructionsOverlay').onclick = (e) => {
  if (e.target.id === 'instructionsOverlay') {
    closeInstructions();
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GAME INITIALIZATION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

const hasExistingSave = loadGame();

// Update buy mode button display
document.querySelectorAll('.buy-mode-btn').forEach(btn => {
  if (parseInt(btn.dataset.mode) === gameState.buyMode) {
    btn.classList.add('active');
  }
});

if (!hasExistingSave) {
  document.getElementById('instructionsOverlay').classList.remove('hidden');
} else {
  document.getElementById('instructionsOverlay').classList.add('hidden');
}

document.getElementById('versionModal').classList.add('hidden');

gameState.targetCoffee = gameState.coffee;
gameState.displayCoffee = gameState.coffee;
gameState.targetCPS = calculateTotalCPS();
gameState.displayCPS = gameState.targetCPS;

updateUI();
</script>
</body>
</html>
<!--
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  COFFEE TYCOON v1.10 â€” A Whole Latte Trade
  Created by: Sanchit P.
  
  CHANGELOG v1.10:
  - Progressive shop unlocking (items appear at â‰¥50% base cost)
  - Added 8 new high-tier buildings (Coffee Planet â†’ Coffee Multiverse)
  - Bulk buy system: Ã—1, Ã—10, Ã—100 with geometric cost calculation
  - Sell system: Sell 1 building for 50% refund
  - Building buffs: 2Ã—-5Ã— multipliers for Coffee Grinder and above
  - CPS Achievement Pack: milestones from 1 CPS â†’ 100 quintillion CPS (1e20)
  - All achievements renamed with coffee puns
  - Fixed achievement notifications (claim text now says "Claimed" not "Purchase")
  - Fixed duplicate achievement notifications
  - Updated credits to Sanchit P.
  - Maintained full save compatibility with v1.9
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->
