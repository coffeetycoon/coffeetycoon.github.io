<html lang="en"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Coffee Tycoon v1.9</title>
<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  * { font-family: 'Comfortaa', cursive; box-sizing: border-box; }
  body { 
    margin: 0; 
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); 
    color: #f5f5f5; 
    min-height: 100vh;
  }
  header { 
    padding: 24px; 
    text-align: center; 
    background: rgba(45, 45, 45, 0.95);
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    position: relative;
  }
  header h1 { 
    margin: 0 0 8px 0; 
    font-size: 2.5rem; 
    font-weight: 700;
    background: linear-gradient(135deg, #d4a574, #8b6f47);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  header p { 
    margin: 4px 0; 
    font-size: 1rem; 
    opacity: 0.9;
  }
  .header-buttons {
    position: absolute;
    top: 24px;
    right: 24px;
    display: flex;
    gap: 12px;
  }
  .help-btn, .info-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid rgba(212, 165, 116, 0.5);
    color: #d4a574;
    font-size: 1.3rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .help-btn:hover, .info-btn:hover {
    background: rgba(212, 165, 116, 0.2);
    transform: scale(1.1);
    border-color: #d4a574;
  }
  .status-bar {
    display: flex;
    justify-content: center;
    gap: 32px;
    margin: 16px 0;
    flex-wrap: wrap;
  }
  .stat {
    background: rgba(255, 255, 255, 0.1);
    padding: 12px 24px;
    border-radius: 12px;
    font-size: 1.1rem;
    font-weight: 600;
    backdrop-filter: blur(5px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  }
  main { 
    max-width: 1400px; 
    margin: 0 auto; 
    padding: 24px; 
  }
  .tabs {
    display: flex;
    gap: 12px;
    margin-bottom: 24px;
    justify-content: center;
    flex-wrap: wrap;
  }
  .tab-btn {
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid transparent;
    padding: 12px 28px;
    border-radius: 12px;
    color: #f5f5f5;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    backdrop-filter: blur(5px);
    position: relative;
  }
  .tab-btn:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  }
  .tab-btn.active {
    background: linear-gradient(135deg, #d4a574, #8b6f47);
    border-color: #d4a574;
    color: #1a1a2e;
  }
  .notification-badge {
    position: absolute;
    top: 8px;
    right: 8px;
    width: 7px;
    height: 7px;
    min-width: 7px;
    padding: 0;
    margin-left: 0;
    border-radius: 50%;
    font-size: 0;
    border: 1px solid #1a1a2e;
    pointer-events: none;
    background: #ff4444;
  }
  .content-area {
    background: rgba(45, 45, 45, 0.8);
    border-radius: 16px;
    padding: 24px;
    min-height: 400px;
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  }
  .tab-content { display: none; }
  .tab-content.active { display: block; }
  .shop-item, .upgrade-item {
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 16px;
    transition: all 0.3s ease;
  }
  .shop-item:hover, .upgrade-item:hover {
    border-color: rgba(212, 165, 116, 0.5);
    background: rgba(255, 255, 255, 0.08);
  }
  .shop-item.affordable, .upgrade-item.affordable {
    border-color: rgba(76, 175, 80, 0.5);
    background: rgba(76, 175, 80, 0.1);
  }
  .shop-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .item-info {
    flex: 1;
  }
  .item-name, .upgrade-name {
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 4px;
    color: #d4a574;
  }
  .item-effect {
    font-size: 0.95rem;
    opacity: 0.9;
  }
  .item-actions {
    display: flex;
    gap: 12px;
    align-items: center;
  }
  .quantity-display {
    background: rgba(255, 255, 255, 0.1);
    padding: 8px 16px;
    border-radius: 8px;
    font-weight: 600;
    min-width: 40px;
    text-align: center;
  }
  .buy-btn, .upgrade-buy-btn {
    background: linear-gradient(135deg, #4CAF50, #45a049);
    border: none;
    padding: 12px 24px;
    border-radius: 10px;
    color: #fff;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
  }
  .buy-btn:hover:not(:disabled), .upgrade-buy-btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(76, 175, 80, 0.4);
  }
  .buy-btn:active:not(:disabled), .upgrade-buy-btn:active:not(:disabled) {
    transform: translateY(0);
  }
  .buy-btn:disabled, .upgrade-buy-btn:disabled {
    background: rgba(100, 100, 100, 0.5);
    cursor: not-allowed;
    box-shadow: none;
  }
  .cost-tile {
    background: rgba(212, 165, 116, 0.2);
    border: 2px solid rgba(212, 165, 116, 0.5);
    padding: 10px 20px;
    border-radius: 10px;
    font-weight: 700;
    font-size: 1.1rem;
    color: #d4a574;
    min-width: 120px;
    text-align: center;
  }
  .upgrade-item.purchased {
    border-color: rgba(255, 215, 0, 0.5);
    background: rgba(255, 215, 0, 0.1);
    opacity: 0.6;
  }
  .upgrade-item.locked {
    border-color: rgba(255, 255, 255, 0.05);
    background: rgba(255, 255, 255, 0.02);
    opacity: 0.5;
  }
  .upgrade-item.locked:hover {
    border-color: rgba(255, 255, 255, 0.1);
    background: rgba(255, 255, 255, 0.03);
  }
  .upgrade-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    gap: 12px;
  }
  .upgrade-name {
    flex: 1;
    min-width: 0;
  }
  .upgrade-status {
    font-size: 1.1rem;
    font-weight: 600;
    color: #ffd700;
    white-space: nowrap;
    flex-shrink: 0;
  }
  .upgrade-status.locked {
    color: #ff6b6b;
  }
  .upgrade-description {
    font-size: 1rem;
    line-height: 1.6;
    margin-bottom: 16px;
    opacity: 0.9;
  }
  .upgrade-unlock-req {
    font-size: 0.9rem;
    color: #ff6b6b;
    margin-top: 8px;
    font-style: italic;
  }
  .upgrade-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .upgrade-pack {
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    margin-bottom: 16px;
  }
  .upgrade-pack:hover {
    border-color: rgba(212, 165, 116, 0.5);
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-2px);
  }
  .upgrade-pack-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }
  .upgrade-pack-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: #d4a574;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .upgrade-pack-icon {
    font-size: 1.5rem;
  }
  .upgrade-pack-progress {
    font-size: 1.1rem;
    font-weight: 600;
    color: #4CAF50;
  }
  .upgrade-pack-description {
    opacity: 0.9;
    margin-bottom: 12px;
  }
  .upgrade-pack-preview {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-bottom: 12px;
  }
  .upgrade-pack-badge {
    font-size: 1.5rem;
  }
  .upgrade-pack-toggle {
    font-size: 1rem;
    opacity: 0.6;
    margin-top: 8px;
    text-align: center;
    font-weight: 600;
  }
  .upgrade-pack-content {
    max-height: 10000px;
    transition: max-height 0.3s ease, opacity 0.3s ease, margin-top 0.3s ease;
    margin-top: 16px;
    overflow: visible;
  }
  .upgrade-pack-content.collapsed {
    max-height: 0;
    opacity: 0;
    overflow: hidden;
    margin-top: 0;
  }
  #coffeeButton {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    background: linear-gradient(135deg, #d4a574, #8b6f47);
    border: none;
    font-size: 4rem;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 8px 24px rgba(212, 165, 116, 0.4);
    margin: 20px auto;
    display: block;
  }
  #coffeeButton:hover {
    transform: scale(1.05);
    box-shadow: 0 12px 32px rgba(212, 165, 116, 0.5);
  }
  #coffeeButton:active {
    transform: scale(0.95);
  }
  .achievement {
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 16px;
  }
  .achievement.unlocked {
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.1);
  }
  .achievement.claimed {
    border-color: #4CAF50;
    background: rgba(76, 175, 80, 0.1);
  }
  .achievements-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
    gap: 16px;
  }
  .achievement-pack {
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
  }
  .achievement-pack:hover {
    border-color: rgba(212, 165, 116, 0.5);
    background: rgba(255, 255, 255, 0.08);
    transform: translateY(-2px);
  }
  .achievement-pack .notification-badge {
    top: 16px;
    right: 16px;
  }
  .pack-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }
  .pack-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: #d4a574;
  }
  .pack-progress {
    font-size: 1.1rem;
    font-weight: 600;
    color: #4CAF50;
  }
  .pack-description {
    opacity: 0.9;
    margin-bottom: 12px;
  }
  .pack-preview {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }
  .pack-badge {
    font-size: 1.5rem;
  }
  .achievement-reward {
    background: rgba(76, 175, 80, 0.1);
    border: 1px solid rgba(76, 175, 80, 0.3);
    padding: 8px 12px;
    border-radius: 8px;
    margin-top: 8px;
    font-size: 0.9rem;
    color: #4CAF50;
    font-weight: 600;
  }
  .modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    animation: fadeIn 0.3s ease;
  }
  .modal.hidden {
    display: none;
  }
  .modal-content {
    background: linear-gradient(135deg, #2d2d2d, #1a1a2e);
    border: 3px solid #d4a574;
    border-radius: 20px;
    padding: 32px;
    max-width: 900px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
  }
  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 24px;
  }
  .modal-title {
    font-size: 2rem;
    font-weight: 700;
    color: #d4a574;
  }
  .modal-close {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    color: #f5f5f5;
    font-size: 2rem;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.2s ease;
    line-height: 1;
  }
  .modal-close:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: rotate(90deg);
  }
  .modal-achievements {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 16px;
  }
  .modal-achievement {
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 16px;
    transition: all 0.3s ease;
  }
  .modal-achievement.unlocked {
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.1);
  }
  .modal-achievement.claimed {
    border-color: #4CAF50;
    background: rgba(76, 175, 80, 0.1);
  }
  .modal-achievement.unclaimed {
    border-color: #ffd700;
    background: rgba(255, 215, 0, 0.15);
    cursor: pointer;
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
    animation: achievement-glow 2s ease-in-out infinite;
  }
  .modal-achievement.unclaimed:hover {
    transform: scale(1.02);
    box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
  }
  @keyframes achievement-glow {
    0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.4); }
    50% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.6); }
  }
  .version-content {
    line-height: 1.8;
  }
  .version-content h3 {
    color: #d4a574;
    margin-top: 24px;
    margin-bottom: 12px;
  }
  .version-content ul {
    margin: 12px 0;
    padding-left: 24px;
  }
  .version-content li {
    margin: 8px 0;
  }
  .version-content a {
    color: #4CAF50;
    text-decoration: none;
    transition: color 0.3s ease;
  }
  .version-content a:hover {
    color: #66BB6A;
    text-decoration: underline;
  }
  .progress {
    height: 8px;
    background: #555;
    border-radius: 4px;
    overflow: hidden;
    margin-top: 8px;
  }
  .progress-bar {
    height: 100%;
    background: #d2691e;
    transition: width 0.3s;
  }
  .prestige-container {
    max-width: 700px;
    margin: 0 auto;
  }
  .prestige-info {
    background: rgba(255, 215, 0, 0.1);
    border: 2px solid rgba(255, 215, 0, 0.3);
    border-radius: 16px;
    padding: 24px;
    margin-bottom: 24px;
    text-align: center;
  }
  .prestige-button {
    background: linear-gradient(135deg, #ffd700, #ffed4e);
    border: none;
    padding: 20px 48px;
    border-radius: 16px;
    color: #1a1a2e;
    font-size: 1.3rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
    display: block;
    margin: 24px auto;
    width: 100%;
    max-width: 400px;
  }
  .prestige-button:hover:not(:disabled) {
    transform: translateY(-3px);
    box-shadow: 0 8px 28px rgba(255, 215, 0, 0.5);
  }
  .prestige-button:disabled {
    background: rgba(100, 100, 100, 0.5);
    cursor: not-allowed;
    opacity: 0.5;
  }
  .notification-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: 10px;
    pointer-events: none;
    max-width: 420px;
  }
  .notification {
    background: linear-gradient(135deg, #2d2d2d, #1a1a2e);
    border: 2px solid #d4a574;
    border-radius: 12px;
    padding: 16px 20px;
    min-width: 300px;
    max-width: 400px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
    animation: slideInNotif 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    pointer-events: auto;
    cursor: pointer;
    transition: opacity 0.3s ease, transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    opacity: 1;
    transform: translateX(0);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    margin-bottom: 0;
  }
  .notification:hover {
    transform: translateX(-4px);
  }
  .notification.fade-out {
    opacity: 0;
    transform: translateX(450px);
    transition: opacity 0.3s ease, transform 0.3s ease;
  }
  .notification.achievement-notif {
    border-color: #ffd700;
    background: linear-gradient(135deg, #3d3d1e, #2a2a1e);
  }
  .notification.upgrade-notif {
    border-color: #4CAF50;
    background: linear-gradient(135deg, #1e3d2d, #1e2a2a);
  }
  .notification.purchase-notif {
    border-color: #66BB6A;
    background: linear-gradient(135deg, #1e2a2a, #1e3d2d);
  }
  .notification.purchase-notif .notification-title {
    color: #66BB6A;
  }
  .notification-title {
    font-size: 1.1rem;
    font-weight: 700;
    margin-bottom: 4px;
    color: #d4a574;
    line-height: 1.3;
  }
  .notification.achievement-notif .notification-title {
    color: #ffd700;
  }
  .notification.upgrade-notif .notification-title {
    color: #4CAF50;
  }
  .notification-message {
    font-size: 0.95rem;
    opacity: 0.9;
    line-height: 1.4;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  @keyframes slideInNotif {
    from { 
      transform: translateX(450px); 
      opacity: 0; 
    }
    to { 
      transform: translateX(0); 
      opacity: 1; 
    }
  }
  .overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10000;
    animation: fadeIn 0.3s ease;
  }
  .overlay.hidden { display: none; }
  .instructions-modal {
    background: linear-gradient(135deg, #2d2d2d, #1a1a2e);
    border: 3px solid #d4a574;
    border-radius: 20px;
    padding: 40px;
    max-width: 600px;
    width: 90%;
    box-shadow: 0 10px 50px rgba(0, 0, 0, 0.5);
    max-height: 90vh;
    overflow-y: auto;
  }
  .instructions-modal h2 {
    margin-top: 0;
    color: #d4a574;
    font-size: 2rem;
    text-align: center;
  }
  .key-guide {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 12px;
    padding: 16px;
    margin: 16px 0;
  }
  .key-item {
    display: flex;
    align-items: center;
    margin: 8px 0;
  }
  .key {
    background: linear-gradient(135deg, #d4a574, #8b6f47);
    color: #1a1a2e;
    padding: 8px 16px;
    border-radius: 8px;
    font-weight: 700;
    min-width: 40px;
    text-align: center;
    margin-right: 16px;
  }
  .start-btn {
    background: linear-gradient(135deg, #d4a574, #8b6f47);
    border: none;
    padding: 16px 48px;
    border-radius: 12px;
    color: #1a1a2e;
    font-size: 1.2rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s ease;
    display: block;
    margin: 24px auto 0;
  }
  .start-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(212, 165, 116, 0.5);
  }
  .empty-state {
    text-align: center;
    padding: 40px;
    opacity: 0.6;
    font-size: 1.1rem;
    grid-column: 1 / -1;
  }
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
</style>
</head>
<body>
<div id="notificationContainer" class="notification-container"></div>

<div id="instructionsOverlay" class="overlay hidden">
  <div class="instructions-modal">
    <h2>Welcome to Coffee Tycoon!</h2>
    <h3 style="color: #d4a574; margin-top: 24px;">How to Play:</h3>
    <p>Build your coffee empire from the ground up! Click the coffee cup to brew coffee manually, then purchase items from the Shop to automate your production.</p>
    <h3 style="color: #d4a574; margin-top: 24px;">Quick Keys:</h3>
    <div class="key-guide">
      <div class="key-item">
        <span class="key">1</span>
        <span>Brew House - Manual brewing</span>
      </div>
      <div class="key-item">
        <span class="key">2</span>
        <span>Shop - Purchase production items</span>
      </div>
      <div class="key-item">
        <span class="key">3</span>
        <span>Upgrades - Permanent improvements</span>
      </div>
      <div class="key-item">
        <span class="key">4</span>
        <span>Prestige - Reset for bonuses</span>
      </div>
      <div class="key-item">
        <span class="key">5</span>
        <span>Achievements - Track progress & earn rewards</span>
      </div>
    </div>
    <h3 style="color: #d4a574; margin-top: 24px;">Goal:</h3>
    <p>Earn coffee, unlock upgrades progressively, and reach 10 billion coffee to prestige for permanent Golden Coffee bonuses!</p>
    <button class="start-btn" id="startGameBtn">Start Brewing!</button>
  </div>
</div>

<div id="versionModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title">Coffee Tycoon v1.9</div>
      <button class="modal-close" id="closeVersionModal">×</button>
    </div>
    <div class="version-content">
      <h3>What's New in v1.9 – Riches and Reaches</h3>
      <ul>
        <li><strong>Extended Achievements:</strong> Coffee collection achievements now scale up to 1 quintillion (1 × 10¹⁸)</li>
        <li><strong>More Item Milestones:</strong> Shop item collection achievements now scale up to 5,000 items</li>
        <li><strong>Upgrade Collection Pack:</strong> New achievement pack that tracks upgrade purchase milestones (10%, 20%, 30%...100%)</li>
        <li><strong>Major Rebalance:</strong> Items from Coffee Grinder onward buffed significantly (≥2× compared to v1.8.1)</li>
        <li><strong>Cleaner UI:</strong> Removed numeric counters from packs, keeping only visual progress bars</li>
        <li><strong>Green Claimed Achievements:</strong> Claimed achievements now display with green borders and backgrounds</li>
        <li><strong>Better Notifications:</strong> Affordable upgrades show "!" indicators, unified notification styling</li>
      </ul>
      <h3>Gameplay Tips</h3>
      <ul>
        <li>Earn achievements to get instant coffee bonuses and permanent production boosts</li>
        <li>Focus on one shop item at a time to unlock its upgrade series</li>
        <li>Upgrade costs scale ×10 per tier - plan your purchases carefully</li>
        <li>Global upgrades affect all items - save up for huge boosts!</li>
      </ul>
      <h3>About</h3>
      <p><strong>Version:</strong> 1.9 - Riches and Reaches</p>
      <p><strong>Created by:</strong> randomdoge</p>
      <p><strong>Play Online:</strong> <a href="https://coffeetycoon.github.io/Coffee-Tycoon/" target="_blank">coffeetycoon.github.io/Coffee-Tycoon</a></p>
      <p><strong>GitHub:</strong> <a href="https://github.com/CoffeeTycoon/Coffee-Tycoon" target="_blank">View Repository</a></p>
      <p><strong>Report a Bug:</strong> <a href="https://github.com/coffeetycoon/Coffee-Tycoon/issues" target="_blank">Bug Reporting</a></p>
    </div>
  </div>
</div>

<header>
  <div class="header-buttons">
    <button class="help-btn" id="helpBtn" title="Help">?</button>
    <button class="info-btn" id="infoBtn" title="Info">i</button>
  </div>
  <h1>Coffee Tycoon</h1>
  <p>Brew coffee, earn rewards, and build your empire!</p>
  <div class="status-bar">
    <div class="stat">Coffee: <span id="coffeeDisplay">0</span></div>
    <div class="stat">CPS: <span id="cpsDisplay">0</span></div>
    <div class="stat">Golden Coffee: <span id="goldenCoffeeDisplay">0</span></div>
  </div>
</header>

<main>
  <div class="tabs">
    <button class="tab-btn active" data-tab="brew">Brew House</button>
    <button class="tab-btn" data-tab="shop">Shop</button>
    <button class="tab-btn" data-tab="upgrades">Upgrades</button>
    <button class="tab-btn" data-tab="prestige">Prestige</button>
    <button class="tab-btn" data-tab="achievements">Achievements</button>
  </div>
  <div class="content-area">
    <div id="brewTab" class="tab-content active">
      <div style="text-align: center;">
        <button id="coffeeButton">☕</button>
        <div style="font-size: 1.2rem; margin-top: 16px;">Click the cup to brew coffee!</div>
        <div style="margin-top: 12px; opacity: 0.8;">Each click: +<span id="clickPowerDisplay">1</span> Coffee</div>
      </div>
    </div>
    <div id="shopTab" class="tab-content">
      <h2 style="margin-top: 0; color: #d4a574;">Shop</h2>
      <div id="shopList"></div>
    </div>
    <div id="upgradesTab" class="tab-content">
      <h2 style="margin-top: 0; color: #d4a574;">Upgrades</h2>
      <div id="upgradesList" class="achievements-grid"></div>
    </div>
    <div id="prestigeTab" class="tab-content">
      <h2 style="margin-top: 0; color: #d4a574;">Prestige</h2>
      <div id="prestigeContent"></div>
    </div>
    <div id="achievementsTab" class="tab-content">
      <h2 style="margin-top: 0; color: #d4a574;">Achievements</h2>
      <div id="achievementsList" class="achievements-grid"></div>
    </div>
  </div>
</main>

<div id="achievementModal" class="modal hidden">
  <div class="modal-content">
    <div class="modal-header">
      <div class="modal-title" id="modalTitle">Achievement Pack</div>
      <button class="modal-close" id="closeAchievementModal">×</button>
    </div>
    <div class="modal-achievements" id="modalAchievements"></div>
  </div>
</div>

<script>
let activeNotifications = [];
let notificationIdCounter = 0;
let notificationTimers = new Map();

const gameState = {
  coffee: 0,
  totalCoffeeAllTime: 0,
  clickPower: 1,
  goldenCoffee: 0,
  prestigeMultiplier: 1.0,
  items: {},
  purchasedUpgrades: new Set(),
  itemMultipliers: {},
  viewedUpgrades: new Set(),
  viewedAchievements: new Set(),
  achievements: [],
  collapsedPacks: new Set(),
  unclaimedAchievements: new Set(),
  displayCoffee: 0,
  displayCPS: 0,
  targetCoffee: 0,
  targetCPS: 0
};

gameState.items = gameState.items || {};

/* === Coffee Tycoon v1.9 – Riches and Reaches === */
const shopItems = [
  { id: 'brewer', name: 'Auto Brewer', baseCost: 50, cps: 5, scale: 1.15 },
  { id: 'barista', name: 'Barista', baseCost: 500, cps: 10, scale: 1.15 },
  { id: 'grinder', name: 'Coffee Grinder', baseCost: 5000, cps: 50, scale: 1.2 },
  { id: 'espresso', name: 'Espresso Machine', baseCost: 50000, cps: 250, scale: 1.2 },
  { id: 'truck', name: 'Coffee Truck', baseCost: 200000, cps: 1000, scale: 1.25 },
  { id: 'factory', name: 'Coffee Factory', baseCost: 1000000, cps: 10000, scale: 1.25 },
  { id: 'corporation', name: 'Coffee Corporation', baseCost: 8000000, cps: 100000, scale: 1.3 },
  { id: 'franchise', name: 'Coffee Franchise', baseCost: 50000000, cps: 1000000, scale: 1.3 }
];

shopItems.forEach(item => {
  gameState.items[item.id] = { count: 0, cost: item.baseCost };
});

const upgrades = [
  { 
    id: 'click_1', 
    name: 'Better Coffee Beans', 
    description: '+1 coffee per click', 
    cost: 1500, 
    effect: () => { gameState.clickPower += 1; },
    unlockCondition: () => gameState.totalCoffeeAllTime >= 1000,
    pack: 'click-power'
  },
  { 
    id: 'click_2', 
    name: 'Premium Coffee Beans', 
    description: '+2 coffee per click', 
    cost: 15000, 
    effect: () => { gameState.clickPower += 2; },
    unlockCondition: () => gameState.totalCoffeeAllTime >= 10000,
    pack: 'click-power'
  },
  { 
    id: 'click_3', 
    name: 'Exotic Coffee Beans', 
    description: '+5 coffee per click', 
    cost: 150000, 
    effect: () => { gameState.clickPower += 5; },
    unlockCondition: () => gameState.totalCoffeeAllTime >= 100000,
    pack: 'click-power'
  },
  { 
    id: 'brewer_1', 
    name: 'Upgraded Brewers', 
    description: 'Auto Brewers produce 2× coffee', 
    cost: 500, 
    effect: () => { gameState.itemMultipliers.brewer = (gameState.itemMultipliers.brewer || 1) * 2; },
    unlockCondition: () => (gameState.items?.brewer?.count ?? 0) >= 10,
    pack: 'brewer'
  },
  { 
    id: 'brewer_2', 
    name: 'Advanced Brewers', 
    description: 'Auto Brewers produce 2× coffee', 
    cost: 5000, 
    effect: () => { gameState.itemMultipliers.brewer = (gameState.itemMultipliers.brewer || 1) * 2; },
    unlockCondition: () => (gameState.items?.brewer?.count ?? 0) >= 25,
    pack: 'brewer'
  },
  { 
    id: 'brewer_3', 
    name: 'Industrial Brewers', 
    description: 'Auto Brewers produce 2× coffee', 
    cost: 50000, 
    effect: () => { gameState.itemMultipliers.brewer = (gameState.itemMultipliers.brewer || 1) * 2; },
    unlockCondition: () => (gameState.items?.brewer?.count ?? 0) >= 50,
    pack: 'brewer'
  },
  { 
    id: 'brewer_4', 
    name: 'Quantum Brewers', 
    description: 'Auto Brewers produce 2× coffee', 
    cost: 500000, 
    effect: () => { gameState.itemMultipliers.brewer = (gameState.itemMultipliers.brewer || 1) * 2; },
    unlockCondition: () => (gameState.items?.brewer?.count ?? 0) >= 100,
    pack: 'brewer'
  },
  { 
    id: 'brewer_5', 
    name: 'Hyper Brewers', 
    description: 'Auto Brewers produce 2× coffee', 
    cost: 5000000, 
    effect: () => { gameState.itemMultipliers.brewer = (gameState.itemMultipliers.brewer || 1) * 2; },
    unlockCondition: () => (gameState.items?.brewer?.count ?? 0) >= 200,
    pack: 'brewer'
  },
  { 
    id: 'brewer_6', 
    name: 'Ultra Brewers', 
    description: 'Auto Brewers produce 2× coffee', 
    cost: 50000000, 
    effect: () => { gameState.itemMultipliers.brewer = (gameState.itemMultipliers.brewer || 1) * 2; },
    unlockCondition: () => (gameState.items?.brewer?.count ?? 0) >= 400,
    pack: 'brewer'
  },
  { 
    id: 'brewer_7', 
    name: 'Mega Brewers', 
    description: 'Auto Brewers produce 2× coffee', 
    cost: 500000000, 
    effect: () => { gameState.itemMultipliers.brewer = (gameState.itemMultipliers.brewer || 1) * 2; },
    unlockCondition: () => (gameState.items?.brewer?.count ?? 0) >= 700,
    pack: 'brewer'
  },
  { 
    id: 'brewer_8', 
    name: 'Divine Brewers', 
    description: 'Auto Brewers produce 2× coffee', 
    cost: 5000000000, 
    effect: () => { gameState.itemMultipliers.brewer = (gameState.itemMultipliers.brewer || 1) * 2; },
    unlockCondition: () => (gameState.items?.brewer?.count ?? 0) >= 1000,
    pack: 'brewer'
  },
  { 
    id: 'barista_1', 
    name: 'Barista Training', 
    description: 'Baristas produce 2× coffee', 
    cost: 1500, 
    effect: () => { gameState.itemMultipliers.barista = (gameState.itemMultipliers.barista || 1) * 2; },
    unlockCondition: () => (gameState.items?.barista?.count ?? 0) >= 10,
    pack: 'barista'
  },
  { 
    id: 'barista_2', 
    name: 'Expert Baristas', 
    description: 'Baristas produce 2× coffee', 
    cost: 15000, 
    effect: () => { gameState.itemMultipliers.barista = (gameState.itemMultipliers.barista || 1) * 2; },
    unlockCondition: () => (gameState.items?.barista?.count ?? 0) >= 25,
    pack: 'barista'
  },
  { 
    id: 'barista_3', 
    name: 'Master Baristas', 
    description: 'Baristas produce 2× coffee', 
    cost: 150000, 
    effect: () => { gameState.itemMultipliers.barista = (gameState.itemMultipliers.barista || 1) * 2; },
    unlockCondition: () => (gameState.items?.barista?.count ?? 0) >= 50,
    pack: 'barista'
  },
  { 
    id: 'barista_4', 
    name: 'Legendary Baristas', 
    description: 'Baristas produce 2× coffee', 
    cost: 1500000, 
    effect: () => { gameState.itemMultipliers.barista = (gameState.itemMultipliers.barista || 1) * 2; },
    unlockCondition: () => (gameState.items?.barista?.count ?? 0) >= 100,
    pack: 'barista'
  },
  { 
    id: 'barista_5', 
    name: 'Mythic Baristas', 
    description: 'Baristas produce 2× coffee', 
    cost: 15000000, 
    effect: () => { gameState.itemMultipliers.barista = (gameState.itemMultipliers.barista || 1) * 2; },
    unlockCondition: () => (gameState.items?.barista?.count ?? 0) >= 200,
    pack: 'barista'
  },
  { 
    id: 'barista_6', 
    name: 'Cosmic Baristas', 
    description: 'Baristas produce 2× coffee', 
    cost: 150000000, 
    effect: () => { gameState.itemMultipliers.barista = (gameState.itemMultipliers.barista || 1) * 2; },
    unlockCondition: () => (gameState.items?.barista?.count ?? 0) >= 400,
    pack: 'barista'
  },
  { 
    id: 'barista_7', 
    name: 'Celestial Baristas', 
    description: 'Baristas produce 2× coffee', 
    cost: 1500000000, 
    effect: () => { gameState.itemMultipliers.barista = (gameState.itemMultipliers.barista || 1) * 2; },
    unlockCondition: () => (gameState.items?.barista?.count ?? 0) >= 700,
    pack: 'barista'
  },
  { 
    id: 'barista_8', 
    name: 'Transcendent Baristas', 
    description: 'Baristas produce 2× coffee', 
    cost: 15000000000, 
    effect: () => { gameState.itemMultipliers.barista = (gameState.itemMultipliers.barista || 1) * 2; },
    unlockCondition: () => (gameState.items?.barista?.count ?? 0) >= 1000,
    pack: 'barista'
  },
  { 
    id: 'grinder_1', 
    name: 'Steel Grinders', 
    description: 'Coffee Grinders produce 2× coffee', 
    cost: 4000, 
    effect: () => { gameState.itemMultipliers.grinder = (gameState.itemMultipliers.grinder || 1) * 2; },
    unlockCondition: () => (gameState.items?.grinder?.count ?? 0) >= 10,
    pack: 'grinder'
  },
  { 
    id: 'grinder_2', 
    name: 'Titanium Grinders', 
    description: 'Coffee Grinders produce 2× coffee', 
    cost: 40000, 
    effect: () => { gameState.itemMultipliers.grinder = (gameState.itemMultipliers.grinder || 1) * 2; },
    unlockCondition: () => (gameState.items?.grinder?.count ?? 0) >= 25,
    pack: 'grinder'
  },
  { 
    id: 'grinder_3', 
    name: 'Industrial Grinders', 
    description: 'Coffee Grinders produce 2× coffee', 
    cost: 400000, 
    effect: () => { gameState.itemMultipliers.grinder = (gameState.itemMultipliers.grinder || 1) * 2; },
    unlockCondition: () => (gameState.items?.grinder?.count ?? 0) >= 50,
    pack: 'grinder'
  },
  { 
    id: 'grinder_4', 
    name: 'Precision Grinders', 
    description: 'Coffee Grinders produce 2× coffee', 
    cost: 4000000, 
    effect: () => { gameState.itemMultipliers.grinder = (gameState.itemMultipliers.grinder || 1) * 2; },
    unlockCondition: () => (gameState.items?.grinder?.count ?? 0) >= 100,
    pack: 'grinder'
  },
  { 
    id: 'grinder_5', 
    name: 'Nano Grinders', 
    description: 'Coffee Grinders produce 2× coffee', 
    cost: 40000000, 
    effect: () => { gameState.itemMultipliers.grinder = (gameState.itemMultipliers.grinder || 1) * 2; },
    unlockCondition: () => (gameState.items?.grinder?.count ?? 0) >= 200,
    pack: 'grinder'
  },
  { 
    id: 'grinder_6', 
    name: 'Molecular Grinders', 
    description: 'Coffee Grinders produce 2× coffee', 
    cost: 400000000, 
    effect: () => { gameState.itemMultipliers.grinder = (gameState.itemMultipliers.grinder || 1) * 2; },
    unlockCondition: () => (gameState.items?.grinder?.count ?? 0) >= 400,
    pack: 'grinder'
  },
  { 
    id: 'grinder_7', 
    name: 'Atomic Grinders', 
    description: 'Coffee Grinders produce 2× coffee', 
    cost: 4000000000, 
    effect: () => { gameState.itemMultipliers.grinder = (gameState.itemMultipliers.grinder || 1) * 2; },
    unlockCondition: () => (gameState.items?.grinder?.count ?? 0) >= 700,
    pack: 'grinder'
  },
  { 
    id: 'grinder_8', 
    name: 'Quantum Grinders', 
    description: 'Coffee Grinders produce 2× coffee', 
    cost: 40000000000, 
    effect: () => { gameState.itemMultipliers.grinder = (gameState.itemMultipliers.grinder || 1) * 2; },
    unlockCondition: () => (gameState.items?.grinder?.count ?? 0) >= 1000,
    pack: 'grinder'
  },
  { 
    id: 'espresso_1', 
    name: 'High-Pressure Espresso', 
    description: 'Espresso Machines produce 2× coffee', 
    cost: 8000, 
    effect: () => { gameState.itemMultipliers.espresso = (gameState.itemMultipliers.espresso || 1) * 2; },
    unlockCondition: () => (gameState.items?.espresso?.count ?? 0) >= 10,
    pack: 'espresso'
  },
  { 
    id: 'espresso_2', 
    name: 'Dual Boiler Espresso', 
    description: 'Espresso Machines produce 2× coffee', 
    cost: 80000, 
    effect: () => { gameState.itemMultipliers.espresso = (gameState.itemMultipliers.espresso || 1) * 2; },
    unlockCondition: () => gameState.items.espresso.count >= 25,
    pack: 'espresso'
  },
  { 
    id: 'espresso_3', 
    name: 'Professional Espresso', 
    description: 'Espresso Machines produce 2× coffee', 
    cost: 800000, 
    effect: () => { gameState.itemMultipliers.espresso = (gameState.itemMultipliers.espresso || 1) * 2; },
    unlockCondition: () => gameState.items.espresso.count >= 50,
    pack: 'espresso'
  },
  { 
    id: 'espresso_4', 
    name: 'Commercial Espresso', 
    description: 'Espresso Machines produce 2× coffee', 
    cost: 8000000, 
    effect: () => { gameState.itemMultipliers.espresso = (gameState.itemMultipliers.espresso || 1) * 2; },
    unlockCondition: () => gameState.items.espresso.count >= 100,
    pack: 'espresso'
  },
  { 
    id: 'espresso_5', 
    name: 'Automated Espresso', 
    description: 'Espresso Machines produce 2× coffee', 
    cost: 80000000, 
    effect: () => { gameState.itemMultipliers.espresso = (gameState.itemMultipliers.espresso || 1) * 2; },
    unlockCondition: () => gameState.items.espresso.count >= 200,
    pack: 'espresso'
  },
  { 
    id: 'espresso_6', 
    name: 'AI Espresso', 
    description: 'Espresso Machines produce 2× coffee', 
    cost: 800000000, 
    effect: () => { gameState.itemMultipliers.espresso = (gameState.itemMultipliers.espresso || 1) * 2; },
    unlockCondition: () => gameState.items.espresso.count >= 400,
    pack: 'espresso'
  },
  { 
    id: 'espresso_7', 
    name: 'Fusion Espresso', 
    description: 'Espresso Machines produce 2× coffee', 
    cost: 8000000000, 
    effect: () => { gameState.itemMultipliers.espresso = (gameState.itemMultipliers.espresso || 1) * 2; },
    unlockCondition: () => gameState.items.espresso.count >= 700,
    pack: 'espresso'
  },
  { 
    id: 'espresso_8', 
    name: 'Singularity Espresso', 
    description: 'Espresso Machines produce 2× coffee', 
    cost: 80000000000, 
    effect: () => { gameState.itemMultipliers.espresso = (gameState.itemMultipliers.espresso || 1) * 2; },
    unlockCondition: () => gameState.items.espresso.count >= 1000,
    pack: 'espresso'
  },
  { 
    id: 'truck_1', 
    name: 'Upgraded Trucks', 
    description: 'Coffee Trucks produce 2× coffee', 
    cost: 20000, 
    effect: () => { gameState.itemMultipliers.truck = (gameState.itemMultipliers.truck || 1) * 2; },
    unlockCondition: () => (gameState.items?.truck?.count ?? 0) >= 10,
    pack: 'truck'
  },
  { 
    id: 'truck_2', 
    name: 'Fleet Management', 
    description: 'Coffee Trucks produce 2× coffee', 
    cost: 200000, 
    effect: () => { gameState.itemMultipliers.truck = (gameState.itemMultipliers.truck || 1) * 2; },
    unlockCondition: () => gameState.items.truck.count >= 25,
    pack: 'truck'
  },
  { 
    id: 'truck_3', 
    name: 'GPS Navigation', 
    description: 'Coffee Trucks produce 2× coffee', 
    cost: 2000000, 
    effect: () => { gameState.itemMultipliers.truck = (gameState.itemMultipliers.truck || 1) * 2; },
    unlockCondition: () => gameState.items.truck.count >= 50,
    pack: 'truck'
  },
  { 
    id: 'truck_4', 
    name: 'Autonomous Trucks', 
    description: 'Coffee Trucks produce 2× coffee', 
    cost: 20000000, 
    effect: () => { gameState.itemMultipliers.truck = (gameState.itemMultipliers.truck || 1) * 2; },
    unlockCondition: () => gameState.items.truck.count >= 100,
    pack: 'truck'
  },
  { 
    id: 'truck_5', 
    name: 'Electric Fleet', 
    description: 'Coffee Trucks produce 2× coffee', 
    cost: 200000000, 
    effect: () => { gameState.itemMultipliers.truck = (gameState.itemMultipliers.truck || 1) * 2; },
    unlockCondition: () => gameState.items.truck.count >= 200,
    pack: 'truck'
  },
  { 
    id: 'truck_6', 
    name: 'Flying Trucks', 
    description: 'Coffee Trucks produce 2× coffee', 
    cost: 2000000000, 
    effect: () => { gameState.itemMultipliers.truck = (gameState.itemMultipliers.truck || 1) * 2; },
    unlockCondition: () => gameState.items.truck.count >= 400,
    pack: 'truck'
  },
  { 
    id: 'truck_7', 
    name: 'Teleportation Trucks', 
    description: 'Coffee Trucks produce 2× coffee', 
    cost: 20000000000, 
    effect: () => { gameState.itemMultipliers.truck = (gameState.itemMultipliers.truck || 1) * 2; },
    unlockCondition: () => gameState.items.truck.count >= 700,
    pack: 'truck'
  },
  { 
    id: 'truck_8', 
    name: 'Dimensional Trucks', 
    description: 'Coffee Trucks produce 2× coffee', 
    cost: 200000000000, 
    effect: () => { gameState.itemMultipliers.truck = (gameState.itemMultipliers.truck || 1) * 2; },
    unlockCondition: () => gameState.items.truck.count >= 1000,
    pack: 'truck'
  },
  { 
    id: 'factory_1', 
    name: 'Assembly Lines', 
    description: 'Coffee Factories produce 2× coffee', 
    cost: 50000, 
    effect: () => { gameState.itemMultipliers.factory = (gameState.itemMultipliers.factory || 1) * 2; },
    unlockCondition: () => (gameState.items?.factory?.count ?? 0) >= 10,
    pack: 'factory'
  },
  { 
    id: 'factory_2', 
    name: 'Automation Systems', 
    description: 'Coffee Factories produce 2× coffee', 
    cost: 500000, 
    effect: () => { gameState.itemMultipliers.factory = (gameState.itemMultipliers.factory || 1) * 2; },
    unlockCondition: () => gameState.items.factory.count >= 25,
    pack: 'factory'
  },
  { 
    id: 'factory_3', 
    name: 'Quality Control', 
    description: 'Coffee Factories produce 2× coffee', 
    cost: 5000000, 
    effect: () => { gameState.itemMultipliers.factory = (gameState.itemMultipliers.factory || 1) * 2; },
    unlockCondition: () => gameState.items.factory.count >= 50,
    pack: 'factory'
  },
  { 
    id: 'factory_4', 
    name: 'AI Management', 
    description: 'Coffee Factories produce 2× coffee', 
    cost: 50000000, 
    effect: () => { gameState.itemMultipliers.factory = (gameState.itemMultipliers.factory || 1) * 2; },
    unlockCondition: () => gameState.items.factory.count >= 100,
    pack: 'factory'
  },
  { 
    id: 'factory_5', 
    name: 'Nano Manufacturing', 
    description: 'Coffee Factories produce 2× coffee', 
    cost: 500000000, 
    effect: () => { gameState.itemMultipliers.factory = (gameState.itemMultipliers.factory || 1) * 2; },
    unlockCondition: () => gameState.items.factory.count >= 200,
    pack: 'factory'
  },
  { 
    id: 'factory_6', 
    name: 'Quantum Production', 
    description: 'Coffee Factories produce 2× coffee', 
    cost: 5000000000, 
    effect: () => { gameState.itemMultipliers.factory = (gameState.itemMultipliers.factory || 1) * 2; },
    unlockCondition: () => gameState.items.factory.count >= 400,
    pack: 'factory'
  },
  { 
    id: 'factory_7', 
    name: 'Matter Synthesis', 
    description: 'Coffee Factories produce 2× coffee', 
    cost: 50000000000, 
    effect: () => { gameState.itemMultipliers.factory = (gameState.itemMultipliers.factory || 1) * 2; },
    unlockCondition: () => gameState.items.factory.count >= 700,
    pack: 'factory'
  },
  { 
    id: 'factory_8', 
    name: 'Reality Fabrication', 
    description: 'Coffee Factories produce 2× coffee', 
    cost: 500000000000, 
    effect: () => { gameState.itemMultipliers.factory = (gameState.itemMultipliers.factory || 1) * 2; },
    unlockCondition: () => gameState.items.factory.count >= 1000,
    pack: 'factory'
  },
  { 
    id: 'corporation_1', 
    name: 'Corporate Structure', 
    description: 'Coffee Corporations produce 2× coffee', 
    cost: 150000, 
    effect: () => { gameState.itemMultipliers.corporation = (gameState.itemMultipliers.corporation || 1) * 2; },
    unlockCondition: () => (gameState.items?.corporation?.count ?? 0) >= 10,
    pack: 'corporation'
  },
  { 
    id: 'corporation_2', 
    name: 'Market Dominance', 
    description: 'Coffee Corporations produce 2× coffee', 
    cost: 1500000, 
    effect: () => { gameState.itemMultipliers.corporation = (gameState.itemMultipliers.corporation || 1) * 2; },
    unlockCondition: () => gameState.items.corporation.count >= 25,
    pack: 'corporation'
  },
  { 
    id: 'corporation_3', 
    name: 'Global Expansion', 
    description: 'Coffee Corporations produce 2× coffee', 
    cost: 15000000, 
    effect: () => { gameState.itemMultipliers.corporation = (gameState.itemMultipliers.corporation || 1) * 2; },
    unlockCondition: () => gameState.items.corporation.count >= 50,
    pack: 'corporation'
  },
  { 
    id: 'corporation_4', 
    name: 'Monopoly Status', 
    description: 'Coffee Corporations produce 2× coffee', 
    cost: 150000000, 
    effect: () => { gameState.itemMultipliers.corporation = (gameState.itemMultipliers.corporation || 1) * 2; },
    unlockCondition: () => gameState.items.corporation.count >= 100,
    pack: 'corporation'
  },
  { 
    id: 'corporation_5', 
    name: 'Intergalactic Trade', 
    description: 'Coffee Corporations produce 2× coffee', 
    cost: 1500000000, 
    effect: () => { gameState.itemMultipliers.corporation = (gameState.itemMultipliers.corporation || 1) * 2; },
    unlockCondition: () => gameState.items.corporation.count >= 200,
    pack: 'corporation'
  },
  { 
    id: 'corporation_6', 
    name: 'Universal Commerce', 
    description: 'Coffee Corporations produce 2× coffee', 
    cost: 15000000000, 
    effect: () => { gameState.itemMultipliers.corporation = (gameState.itemMultipliers.corporation || 1) * 2; },
    unlockCondition: () => gameState.items.corporation.count >= 400,
    pack: 'corporation'
  },
  { 
    id: 'corporation_7', 
    name: 'Multiversal Business', 
    description: 'Coffee Corporations produce 2× coffee', 
    cost: 150000000000, 
    effect: () => { gameState.itemMultipliers.corporation = (gameState.itemMultipliers.corporation || 1) * 2; },
    unlockCondition: () => gameState.items.corporation.count >= 700,
    pack: 'corporation'
  },
  { 
    id: 'corporation_8', 
    name: 'Omnipresent Empire', 
    description: 'Coffee Corporations produce 2× coffee', 
    cost: 1500000000000, 
    effect: () => { gameState.itemMultipliers.corporation = (gameState.itemMultipliers.corporation || 1) * 2; },
    unlockCondition: () => gameState.items.corporation.count >= 1000,
    pack: 'corporation'
  },
  { 
    id: 'franchise_1', 
    name: 'Regional Marketing', 
    description: 'Coffee Franchises produce 2× coffee', 
    cost: 500000, 
    effect: () => { gameState.itemMultipliers.franchise = (gameState.itemMultipliers.franchise || 1) * 2; },
    unlockCondition: () => (gameState.items?.franchise?.count ?? 0) >= 10,
    pack: 'franchise'
  },
  { 
    id: 'franchise_2', 
    name: 'Brand Recognition', 
    description: 'Coffee Franchises produce 2× coffee', 
    cost: 5000000, 
    effect: () => { gameState.itemMultipliers.franchise = (gameState.itemMultipliers.franchise || 1) * 2; },
    unlockCondition: () => gameState.items.franchise.count >= 25,
    pack: 'franchise'
  },
  { 
    id: 'franchise_3', 
    name: 'National Expansion', 
    description: 'Coffee Franchises produce 2× coffee', 
    cost: 50000000, 
    effect: () => { gameState.itemMultipliers.franchise = (gameState.itemMultipliers.franchise || 1) * 2; },
    unlockCondition: () => gameState.items.franchise.count >= 50,
    pack: 'franchise'
  },
  { 
    id: 'franchise_4', 
    name: 'International Markets', 
    description: 'Coffee Franchises produce 2× coffee', 
    cost: 500000000, 
    effect: () => { gameState.itemMultipliers.franchise = (gameState.itemMultipliers.franchise || 1) * 2; },
    unlockCondition: () => gameState.items.franchise.count >= 100,
    pack: 'franchise'
  },
  { 
    id: 'franchise_5', 
    name: 'Stock Market IPO', 
    description: 'Coffee Franchises produce 2× coffee', 
    cost: 5000000000, 
    effect: () => { gameState.itemMultipliers.franchise = (gameState.itemMultipliers.franchise || 1) * 2; },
    unlockCondition: () => gameState.items.franchise.count >= 200,
    pack: 'franchise'
  },
  { 
    id: 'franchise_6', 
    name: 'Multinational Corporation', 
    description: 'Coffee Franchises produce 2× coffee', 
    cost: 50000000000, 
    effect: () => { gameState.itemMultipliers.franchise = (gameState.itemMultipliers.franchise || 1) * 2; },
    unlockCondition: () => gameState.items.franchise.count >= 400,
    pack: 'franchise'
  },
  { 
    id: 'franchise_7', 
    name: 'Intergalactic Franchise', 
    description: 'Coffee Franchises produce 2× coffee', 
    cost: 500000000000, 
    effect: () => { gameState.itemMultipliers.franchise = (gameState.itemMultipliers.franchise || 1) * 2; },
    unlockCondition: () => gameState.items.franchise.count >= 700,
    pack: 'franchise'
  },
  { 
    id: 'franchise_8', 
    name: 'Universal Coffee Empire', 
    description: 'Coffee Franchises produce 2× coffee', 
    cost: 5000000000000, 
    effect: () => { gameState.itemMultipliers.franchise = (gameState.itemMultipliers.franchise || 1) * 2; },
    unlockCondition: () => gameState.items.franchise.count >= 1000,
    pack: 'franchise'
  },
  { 
    id: 'global_1', 
    name: 'Efficient Operations', 
    description: 'All items produce 1.5× coffee', 
    cost: 500000, 
    effect: () => { 
      shopItems.forEach(item => {
        gameState.itemMultipliers[item.id] = (gameState.itemMultipliers[item.id] || 1) * 1.5;
      });
    },
    unlockCondition: () => {
      return shopItems.every(item => (gameState.items[item.id]?.count || 0) >= 10);
    },
    pack: 'global'
  },
  { 
    id: 'global_2', 
    name: 'Coffee Revolution', 
    description: 'All items produce 2× coffee', 
    cost: 5000000, 
    effect: () => { 
      shopItems.forEach(item => {
        gameState.itemMultipliers[item.id] = (gameState.itemMultipliers[item.id] || 1) * 2;
      });
    },
    unlockCondition: () => {
      return shopItems.every(item => (gameState.items[item.id]?.count || 0) >= 25);
    },
    pack: 'global'
  }
];

const upgradePacks = [
  { 
    id: 'click-power', 
    name: 'Click Power Upgrades', 
    icon: '', 
    description: 'Increase coffee per click'
  },
  { 
    id: 'brewer', 
    name: 'Auto Brewer Upgrades', 
    icon: '', 
    description: 'Boost Auto Brewer production'
  },
  { 
    id: 'barista', 
    name: 'Barista Upgrades', 
    icon: '', 
    description: 'Enhance Barista efficiency'
  },
  { 
    id: 'grinder', 
    name: 'Coffee Grinder Upgrades', 
    icon: '', 
    description: 'Improve Coffee Grinder output'
  },
  { 
    id: 'espresso', 
    name: 'Espresso Machine Upgrades', 
    icon: '', 
    description: 'Upgrade Espresso Machine power'
  },
  { 
    id: 'truck', 
    name: 'Coffee Truck Upgrades', 
    icon: '', 
    description: 'Enhance Coffee Truck capabilities'
  },
  { 
    id: 'factory', 
    name: 'Coffee Factory Upgrades', 
    icon: '', 
    description: 'Amplify Coffee Factory performance'
  },
  { 
    id: 'corporation', 
    name: 'Coffee Corporation Upgrades', 
    icon: '', 
    description: 'Expand Coffee Corporation reach'
  },
  { 
    id: 'franchise', 
    name: 'Coffee Franchise Upgrades', 
    icon: '', 
    description: 'Scale Coffee Franchise operations'
  },
  { 
    id: 'global', 
    name: 'Global Upgrades', 
    icon: '', 
    description: 'Universal production multipliers'
  }
];

/* === Coffee Tycoon v1.9 – Riches and Reaches === */
const achievements = [
  { id: 'first', name: 'First Coffee', requirement: 'Brew 1 coffee', condition: () => gameState.totalCoffeeAllTime >= 1, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/1", percent: () => Math.min(gameState.totalCoffeeAllTime / 1 * 100, 100) || 0, reward: { type: 'coffee', value: 1 } },
  { id: 'ten', name: 'Ten Brews', requirement: 'Brew 10 coffees', condition: () => gameState.totalCoffeeAllTime >= 10, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/10", percent: () => Math.min(gameState.totalCoffeeAllTime / 10 * 100, 100) || 0, reward: { type: 'coffee', value: 5 } },
  { id: 'hundred', name: 'Hundred Brews', requirement: 'Brew 100 coffees', condition: () => gameState.totalCoffeeAllTime >= 100, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/100", percent: () => Math.min(gameState.totalCoffeeAllTime / 100 * 100, 100) || 0, reward: { type: 'coffee', value: 50 } },
  { id: 'thousand', name: 'Thousand Brews', requirement: 'Brew 1,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 1000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/1,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 1000 * 100, 100) || 0, reward: { type: 'coffee', value: 500 } },
  { id: 'tenk', name: 'Ten Thousand', requirement: 'Brew 10,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 10000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/10,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 10000 * 100, 100) || 0, reward: { type: 'coffee', value: 5000 } },
  { id: 'hundredk', name: 'Hundred Thousand', requirement: 'Brew 100,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 100000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/100,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 100000 * 100, 100) || 0, reward: { type: 'coffee', value: 50000 } },
  { id: 'million', name: 'Million Brews', requirement: 'Brew 1,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 1000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/1,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 1000000 * 100, 100) || 0, reward: { type: 'coffee', value: 500000 } },
  { id: 'tenmill', name: 'Ten Million Brews', requirement: 'Brew 10,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 10000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/10,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 10000000 * 100, 100) || 0, reward: { type: 'coffee', value: 5000000 } },
  { id: 'hundredmill', name: 'Hundred Million Brews', requirement: 'Brew 100,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 100000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/100,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 100000000 * 100, 100) || 0, reward: { type: 'coffee', value: 50000000 } },
  { id: 'billion', name: 'Billion Brews', requirement: 'Brew 1,000,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 1000000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/1,000,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 1000000000 * 100, 100) || 0, reward: { type: 'coffee', value: 500000000 } },
  { id: 'tenb', name: 'Ten Billion Brews', requirement: 'Brew 10,000,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 10000000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/10,000,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 10000000000 * 100, 100) || 0, reward: { type: 'coffee', value: 5000000000 } },
  { id: 'hundredb', name: 'Hundred Billion Brews', requirement: 'Brew 100,000,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 100000000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/100,000,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 100000000000 * 100, 100) || 0, reward: { type: 'coffee', value: 50000000000 } },
  { id: 'trillion', name: 'Trillion Brews', requirement: 'Brew 1,000,000,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 1000000000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/1,000,000,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 1000000000000 * 100, 100) || 0, reward: { type: 'coffee', value: 500000000000 } },
  { id: 'tentr', name: 'Ten Trillion Brews', requirement: 'Brew 10,000,000,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 10000000000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/10,000,000,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 10000000000000 * 100, 100) || 0, reward: { type: 'coffee', value: 5000000000000 } },
  { id: 'hundredtr', name: 'Hundred Trillion Brews', requirement: 'Brew 100,000,000,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 100000000000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/100,000,000,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 100000000000000 * 100, 100) || 0, reward: { type: 'coffee', value: 50000000000000 } },
  { id: 'quadrillion', name: 'Quadrillion Brews', requirement: 'Brew 1,000,000,000,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 1000000000000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/1,000,000,000,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 1000000000000000 * 100, 100) || 0, reward: { type: 'coffee', value: 500000000000000 } },
  { id: 'tenq', name: 'Ten Quadrillion Brews', requirement: 'Brew 10,000,000,000,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 10000000000000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/10,000,000,000,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 10000000000000000 * 100, 100) || 0, reward: { type: 'coffee', value: 5000000000000000 } },
  { id: 'hundredq', name: 'Hundred Quadrillion Brews', requirement: 'Brew 100,000,000,000,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 100000000000000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/100,000,000,000,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 100000000000000000 * 100, 100) || 0, reward: { type: 'coffee', value: 50000000000000000 } },
  { id: 'quintillion', name: 'Quintillion Brews', requirement: 'Brew 1,000,000,000,000,000,000 coffees', condition: () => gameState.totalCoffeeAllTime >= 1000000000000000000, earned: false, progress: () => Math.floor(gameState.totalCoffeeAllTime) + "/1,000,000,000,000,000,000", percent: () => Math.min(gameState.totalCoffeeAllTime / 1000000000000000000 * 100, 100) || 0, reward: { type: 'coffee', value: 500000000000000000 } },
  { id: 'first_item', name: 'Novice Collector', requirement: 'Purchase your first item', condition: () => Object.values(gameState.items).some(i => (i?.count ?? 0) >= 1), earned: false, progress: () => Object.values(gameState.items).some(i => (i?.count ?? 0) >= 1) ? "1/1" : "0/1", percent: () => Object.values(gameState.items).some(i => (i?.count ?? 0) >= 1) ? 100 : 0, reward: { type: 'coffee', value: 50 } },
  { id: 'five_any', name: 'Apprentice Purchaser', requirement: 'Have 5 of any single item', condition: () => Object.values(gameState.items).some(i => (i?.count ?? 0) >= 5), earned: false, progress: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return max + "/5";
  }, percent: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return Math.min(max / 5 * 100, 100) || 0;
  }, reward: { type: 'coffee', value: 3 } },
  { id: 'ten_any', name: 'Seasoned Buyer', requirement: 'Have 10 of any single item', condition: () => Object.values(gameState.items).some(i => (i?.count ?? 0) >= 10), earned: false, progress: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return max + "/10";
  }, percent: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return Math.min(max / 10 * 100, 100) || 0;
  }, reward: { type: 'coffee', value: 5 } },
  { id: 'fifty_any', name: 'Bulk Investor', requirement: 'Have 50 of any single item', condition: () => Object.values(gameState.items).some(i => (i?.count ?? 0) >= 50), earned: false, progress: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return max + "/50";
  }, percent: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return Math.min(max / 50 * 100, 100) || 0;
  }, reward: { type: 'coffee', value: 25 } },
  { id: 'hundred_any', name: 'Century Collector', requirement: 'Have 100 of any single item', condition: () => Object.values(gameState.items).some(i => (i?.count ?? 0) >= 100), earned: false, progress: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return max + "/100";
  }, percent: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return Math.min(max / 100 * 100, 100) || 0;
  }, reward: { type: 'coffee', value: 50 } },
  { id: '200_any', name: 'Double Century', requirement: 'Have 200 of any single item', condition: () => Object.values(gameState.items).some(i => (i?.count ?? 0) >= 200), earned: false, progress: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return max + "/200";
  }, percent: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return Math.min(max / 200 * 100, 100) || 0;
  }, reward: { type: 'coffee', value: 100 } },
  { id: '300_any', name: 'Triple Century', requirement: 'Have 300 of any single item', condition: () => Object.values(gameState.items).some(i => (i?.count ?? 0) >= 300), earned: false, progress: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return max + "/300";
  }, percent: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return Math.min(max / 300 * 100, 100) || 0;
  }, reward: { type: 'coffee', value: 150 } },
  { id: '400_any', name: 'Quad Century', requirement: 'Have 400 of any single item', condition: () => Object.values(gameState.items).some(i => (i?.count ?? 0) >= 400), earned: false, progress: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return max + "/400";
  }, percent: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return Math.min(max / 400 * 100, 100) || 0;
  }, reward: { type: 'coffee', value: 200 } },
  { id: '500_any', name: 'Quint Century', requirement: 'Have 500 of any single item', condition: () => Object.values(gameState.items).some(i => (i?.count ?? 0) >= 500), earned: false, progress: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return max + "/500";
  }, percent: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return Math.min(max / 500 * 100, 100) || 0;
  }, reward: { type: 'coffee', value: 250 } },
  { id: '1000_any', name: 'Millennium', requirement: 'Have 1,000 of any single item', condition: () => Object.values(gameState.items).some(i => (i?.count ?? 0) >= 1000), earned: false, progress: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return max + "/1,000";
  }, percent: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return Math.min(max / 1000 * 100, 100) || 0;
  }, reward: { type: 'coffee', value: 500 } },
  { id: '2000_any', name: 'Double Millennium', requirement: 'Have 2,000 of any single item', condition: () => Object.values(gameState.items).some(i => (i?.count ?? 0) >= 2000), earned: false, progress: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return max + "/2,000";
  }, percent: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return Math.min(max / 2000 * 100, 100) || 0;
  }, reward: { type: 'coffee', value: 1000 } },
  { id: '3000_any', name: 'Triple Millennium', requirement: 'Have 3,000 of any single item', condition: () => Object.values(gameState.items).some(i => (i?.count ?? 0) >= 3000), earned: false, progress: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return max + "/3,000";
  }, percent: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return Math.min(max / 3000 * 100, 100) || 0;
  }, reward: { type: 'coffee', value: 1500 } },
  { id: '4000_any', name: 'Quad Millennium', requirement: 'Have 4,000 of any single item', condition: () => Object.values(gameState.items).some(i => (i?.count ?? 0) >= 4000), earned: false, progress: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return max + "/4,000";
  }, percent: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return Math.min(max / 4000 * 100, 100) || 0;
  }, reward: { type: 'coffee', value: 2000 } },
  { id: '5000_any', name: 'Quint Millennium', requirement: 'Have 5,000 of any single item', condition: () => Object.values(gameState.items).some(i => (i?.count ?? 0) >= 5000), earned: false, progress: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return max + "/5,000";
  }, percent: () => {
    const max = Math.max(...Object.values(gameState.items).map(i => i?.count ?? 0), 0);
    return Math.min(max / 5000 * 100, 100) || 0;
  }, reward: { type: 'coffee', value: 2500 } }
];

shopItems.forEach(item => {
  const milestones = [10, 50, 100, 200, 300, 400, 500, 600, 700, 800, 900, 1000, 1500, 2000, 2500, 3000, 3500, 4000, 4500, 5000];
  milestones.forEach(milestone => {
    const multiplier = 1.025 + (milestones.indexOf(milestone) * 0.025);
    achievements.push({
      id: `${item.id}_${milestone}`,
      name: `${item.name} ${milestone >= 1000 ? (milestone/1000).toFixed(0) + 'K' : milestone}`,
      requirement: `Own ${milestone.toLocaleString()} ${item.name}${milestone > 1 ? 's' : ''}`,
      condition: () => (gameState.items[item.id]?.count || 0) >= milestone,
      earned: false,
      progress: () => (gameState.items[item.id]?.count || 0) + "/" + milestone.toLocaleString(),
      percent: () => Math.min((gameState.items[item.id]?.count || 0) / milestone * 100, 100) || 0,
      reward: { type: 'multiplier', value: multiplier, itemId: item.id }
    });
  });
});

for (let i = 10; i <= 100; i += 10) {
  achievements.push({
    id: `upgrades_${i}`,
    name: `Upgrade Collector ${i}%`,
    requirement: `Purchase ${i}% of all upgrades`,
    condition: () => {
      const totalUpgrades = upgrades.length;
      const purchasedCount = gameState.purchasedUpgrades.size;
      return (purchasedCount / totalUpgrades * 100) >= i;
    },
    earned: false,
    progress: () => {
      const totalUpgrades = upgrades.length;
      const purchasedCount = gameState.purchasedUpgrades.size;
      const percent = Math.floor(purchasedCount / totalUpgrades * 100);
      return `${percent}%/${i}%`;
    },
    percent: () => {
      const totalUpgrades = upgrades.length;
      const purchasedCount = gameState.purchasedUpgrades.size;
      const currentPercent = (purchasedCount / totalUpgrades * 100);
      return Math.min(currentPercent / i * 100, 100) || 0;
    },
    reward: { type: 'coffee', value: i * 10000 }
  });
}

gameState.achievements = achievements;

function getVisibleAchievements(achievementList) {
  const visible = [];
  for (let i = 0; i < achievementList.length; i++) {
    const achievement = achievementList[i];
    if (achievement.earned) {
      visible.push(achievement);
    } else {
      const previousEarned = i === 0 || achievementList[i - 1].earned;
      if (previousEarned) {
        visible.push(achievement);
      }
      break;
    }
  }
  return visible;
}

function getAchievementPacks() {
  const packs = [
    {
      id: 'coffee_milestones',
      title: 'Coffee Milestones',
      description: 'Achievements for brewing coffee',
      icon: '',
      achievements: achievements.filter(a => 
        a.id.includes('first') || a.id.includes('ten') || 
        a.id.includes('hundred') || a.id.includes('thousand') || 
        a.id.includes('million') || a.id.includes('billion') || 
        a.id.includes('trillion') || a.id.includes('quadrillion') ||
        a.id.includes('quintillion')
      )
    },
    {
      id: 'general_collection',
      title: 'General Collection',
      description: 'Achievements for collecting any items',
      icon: '',
      achievements: achievements.filter(a => 
        a.id.includes('_item') || 
        a.id.includes('_any')
      )
    },
    {
      id: 'upgrade_collection',
      title: 'Upgrade Collection',
      description: 'Achievements for purchasing upgrades',
      icon: '',
      achievements: achievements.filter(a => a.id.startsWith('upgrades_'))
    }
  ];
  
  shopItems.forEach(item => {
    const itemAchievements = achievements.filter(a => a.id.startsWith(item.id + '_') && !a.id.includes('_any'));
    if (itemAchievements.length > 0) {
      packs.push({
        id: item.id + '_pack',
        title: `${item.name} Collection`,
        description: `Achievements for owning ${item.name}s`,
        icon: '',
        achievements: itemAchievements
      });
    }
  });
  
  return packs;
}

function abbreviateNumber(num) {
  if (num < 1000) return Math.floor(num).toString();
  if (num < 1000000) return (num / 1000).toFixed(1).replace(/\.0$/, '') + 'k';
  if (num < 1000000000) return (num / 1000000).toFixed(1).replace(/\.0$/, '') + 'M';
  if (num < 1000000000000) return (num / 1000000000).toFixed(1).replace(/\.0$/, '') + 'B';
  if (num < 1000000000000000) return (num / 1000000000000).toFixed(1).replace(/\.0$/, '') + 'T';
  if (num < 1000000000000000000) return (num / 1000000000000000).toFixed(1).replace(/\.0$/, '') + 'Q';
  return (num / 1000000000000000000).toFixed(1).replace(/\.0$/, '') + 'Qi';
}

function calculateTotalCPS() {
  let totalCPS = 0;
  shopItems.forEach(item => {
    if (!gameState.items[item.id]) {
      gameState.items[item.id] = { count: 0, cost: item.baseCost };
    }
    const itemState = gameState.items[item.id];
    const multiplier = gameState.itemMultipliers[item.id] || 1;
    const count = itemState.count ?? 0;
    totalCPS += item.cps * count * multiplier;
  });
  return totalCPS * gameState.prestigeMultiplier;
}

function calculateItemCPS(item) {
  const multiplier = gameState.itemMultipliers[item.id] || 1;
  return item.cps * multiplier * gameState.prestigeMultiplier;
}

function showNotification(title, message, type = 'default', metadata = {}) {
  const container = document.getElementById('notificationContainer');
  const notifId = notificationIdCounter++;
  
  const notif = document.createElement('div');
  notif.className = 'notification';
  notif.dataset.notifId = notifId;
  
  if (type === 'achievement') {
    notif.classList.add('achievement-notif');
    notif.dataset.achievementId = metadata.achievementId || '';
  } else if (type === 'upgrade') {
    notif.classList.add('upgrade-notif');
    notif.dataset.packId = metadata.packId || '';
  }
  
  notif.innerHTML = `
    <div class="notification-title">${title}</div>
    <div class="notification-message">${message}</div>
  `;
  
  container.appendChild(notif);
  activeNotifications.push(notif);
  
  updateNotificationPositions();
  
  const timer = setTimeout(() => {
    removeNotificationNow(notif);
  }, 3000);
  notificationTimers.set(notif, timer);
  
  return notifId;
}

function updateNotificationPositions() {
  activeNotifications.forEach((notif, i) => {
    notif.style.transform = `translateY(${i * 10}px)`;
  });
}

function showPurchaseNotification(itemName) {
  const container = document.getElementById('notificationContainer');
  
  const existing = activeNotifications.find(n => 
    n.dataset.itemName === itemName && 
    n.classList.contains('purchase-notif')
  );
  
  if (existing) {
    const messageEl = existing.querySelector('.notification-message');
    const match = messageEl.textContent.match(/x(\d+)/);
    const count = match ? parseInt(match[1]) + 1 : 2;
    
    messageEl.textContent = `Purchased x${count} ${itemName}`;
    existing.dataset.count = count;
    
    const oldTimer = notificationTimers.get(existing);
    if (oldTimer) clearTimeout(oldTimer);
    
    const newTimer = setTimeout(() => {
      removeNotificationNow(existing);
    }, 4000);
    notificationTimers.set(existing, newTimer);
    
    existing.style.transform = 'scale(1.02)';
    setTimeout(() => {
      existing.style.transform = '';
      updateNotificationPositions();
    }, 150);
    
    return;
  }
  
  const notifId = notificationIdCounter++;
  const notif = document.createElement('div');
  notif.className = 'notification purchase-notif';
  notif.dataset.notifId = notifId;
  notif.dataset.itemName = itemName;
  notif.dataset.count = 1;
  
  notif.innerHTML = `
    <div class="notification-title">Purchase Complete</div>
    <div class="notification-message">Purchased ${itemName}</div>
  `;
  
  container.appendChild(notif);
  activeNotifications.push(notif);
  
  updateNotificationPositions();
  
  const timer = setTimeout(() => {
    removeNotificationNow(notif);
  }, 4000);
  notificationTimers.set(notif, timer);
}

function removeNotificationNow(notificationElement) {
  if (!notificationElement || !notificationElement.parentNode) return;
  
  const timer = notificationTimers.get(notificationElement);
  if (timer) {
    clearTimeout(timer);
    notificationTimers.delete(notificationElement);
  }
  
  activeNotifications = activeNotifications.filter(n => n !== notificationElement);
  
  notificationElement.classList.add('fade-out');
  
  updateNotificationPositions();
  
  setTimeout(() => {
    if (notificationElement.parentNode) {
      notificationElement.remove();
    }
  }, 300);
}

function removeNotificationsByAchievement(achievementId) {
  const toRemove = activeNotifications.filter(n => n.dataset.achievementId === achievementId);
  toRemove.forEach(n => removeNotificationNow(n));
}

function removeNotificationsByPack(packId) {
  const toRemove = activeNotifications.filter(n => n.dataset.packId === packId);
  toRemove.forEach(n => removeNotificationNow(n));
}

function getUnlockRequirementText(upgrade) {
  if (upgrade.pack === 'click-power') {
    const requiredCoffee = upgrade.id === 'click_1' ? 1000 : 
                          upgrade.id === 'click_2' ? 10000 : 100000;
    return `Requires ${abbreviateNumber(requiredCoffee)} total coffee brewed (Currently: ${abbreviateNumber(gameState.totalCoffeeAllTime)})`;
  }
  
  const itemMatch = upgrade.id.match(/^(\w+)_(\d+)$/);
  if (itemMatch) {
    const itemId = itemMatch[1];
    const tier = parseInt(itemMatch[2]);
    const itemName = shopItems.find(i => i.id === itemId)?.name || itemId;
    const requirements = [10, 25, 50, 100, 200, 400, 700, 1000];
    const required = requirements[tier - 1] || 0;
    const current = (gameState.items[itemId]?.count ?? 0);
    return `Requires ${required} ${itemName}s (Currently: ${current})`;
  }
  
  if (upgrade.pack === 'global') {
    if (upgrade.id === 'global_1') {
      return `Requires 10 of each item type`;
    } else if (upgrade.id === 'global_2') {
      return `Requires 25 of each item type`;
    }
  }
  
  return 'Unlock requirements not met';
}

function getRewardText(reward) {
  if (reward.type === 'coffee') {
    return `Reward: ${abbreviateNumber(reward.value)} Coffee`;
  } else if (reward.type === 'multiplier') {
    const itemName = shopItems.find(i => i.id === reward.itemId)?.name;
    const multiplierPercent = ((reward.value - 1) * 100).toFixed(1);
    return `Reward: +${multiplierPercent}% ${itemName} production`;
  }
  return '';
}

function claimAchievementReward(achievement) {
  if (!achievement.reward || !gameState.unclaimedAchievements.has(achievement.id)) return '';
  
  gameState.unclaimedAchievements.delete(achievement.id);
  gameState.viewedAchievements.add(achievement.id);
  
  removeNotificationsByAchievement(achievement.id);
  
  showPurchaseNotification(`Claimed: ${achievement.name}`);
  
  if (achievement.reward.type === 'coffee') {
    gameState.coffee += achievement.reward.value;
    gameState.targetCoffee = gameState.coffee;
    saveGame();
    updateUI();
    return ` (+${abbreviateNumber(achievement.reward.value)} coffee!)`;
  } else if (achievement.reward.type === 'multiplier') {
    const itemId = achievement.reward.itemId;
    gameState.itemMultipliers[itemId] = (gameState.itemMultipliers[itemId] || 1) * achievement.reward.value;
    const itemName = shopItems.find(i => i.id === itemId)?.name;
    const multiplierPercent = ((achievement.reward.value - 1) * 100).toFixed(1);
    saveGame();
    updateUI();
    return ` (+${multiplierPercent}% ${itemName} production!)`;
  }
  
  return '';
}

function saveGame() {
  const saveData = {
    coffee: gameState.coffee,
    totalCoffeeAllTime: gameState.totalCoffeeAllTime,
    clickPower: gameState.clickPower,
    goldenCoffee: gameState.goldenCoffee,
    prestigeMultiplier: gameState.prestigeMultiplier,
    items: gameState.items,
    purchasedUpgrades: Array.from(gameState.purchasedUpgrades),
    itemMultipliers: gameState.itemMultipliers,
    viewedUpgrades: Array.from(gameState.viewedUpgrades),
    viewedAchievements: Array.from(gameState.viewedAchievements),
    achievements: gameState.achievements.map(a => ({ id: a.id, earned: a.earned })),
    collapsedPacks: Array.from(gameState.collapsedPacks),
    unclaimedAchievements: Array.from(gameState.unclaimedAchievements)
  };
  localStorage.setItem('coffeeTycoonSave', JSON.stringify(saveData));
}

function loadGame() {
  const saved = localStorage.getItem('coffeeTycoonSave');
  if (saved) {
    const data = JSON.parse(saved);
    gameState.coffee = data.coffee || 0;
    gameState.totalCoffeeAllTime = data.totalCoffeeAllTime || 0;
    gameState.clickPower = data.clickPower || 1;
    gameState.goldenCoffee = data.goldenCoffee || 0;
    gameState.prestigeMultiplier = data.prestigeMultiplier || 1.0;
    gameState.items = data.items || {};
    gameState.purchasedUpgrades = new Set(data.purchasedUpgrades || []);
    gameState.itemMultipliers = data.itemMultipliers || {};
    gameState.viewedUpgrades = new Set(data.viewedUpgrades || []);
    gameState.viewedAchievements = new Set(data.viewedAchievements || []);
    gameState.collapsedPacks = new Set(data.collapsedPacks || []);
    gameState.unclaimedAchievements = new Set(data.unclaimedAchievements || []);
    
    shopItems.forEach(item => {
      if (!gameState.items[item.id]) {
        gameState.items[item.id] = { count: 0, cost: item.baseCost };
      }
    });
    
    if (data.achievements) {
      data.achievements.forEach(savedAch => {
        const ach = gameState.achievements.find(a => a.id === savedAch.id);
        if (ach) ach.earned = savedAch.earned;
      });
    }
    return true;
  }
  return false;
}

function updateNotificationBadges() {
  const availableUpgrades = upgrades.filter(u => 
    u.unlockCondition() && 
    !gameState.purchasedUpgrades.has(u.id) && 
    !gameState.viewedUpgrades.has(u.id)
  );
  const upgradesBtn = document.querySelector('[data-tab="upgrades"]');
  let upgradeBadge = upgradesBtn.querySelector('.notification-badge');
  if (availableUpgrades.length > 0 && !upgradeBadge) {
    upgradeBadge = document.createElement('div');
    upgradeBadge.className = 'notification-badge';
    upgradesBtn.appendChild(upgradeBadge);
  } else if (availableUpgrades.length === 0 && upgradeBadge) {
    upgradeBadge.remove();
  }
  
  const unclaimedCount = gameState.unclaimedAchievements.size;
  const achievementsBtn = document.querySelector('[data-tab="achievements"]');
  let achievementBadge = achievementsBtn.querySelector('.notification-badge');
  if (unclaimedCount > 0 && !achievementBadge) {
    achievementBadge = document.createElement('div');
    achievementBadge.className = 'notification-badge';
    achievementsBtn.appendChild(achievementBadge);
  } else if (unclaimedCount === 0 && achievementBadge) {
    achievementBadge.remove();
  }
}

function updateUI() {
  document.getElementById('coffeeDisplay').textContent = abbreviateNumber(gameState.displayCoffee);
  document.getElementById('cpsDisplay').textContent = abbreviateNumber(gameState.displayCPS);
  document.getElementById('goldenCoffeeDisplay').textContent = gameState.goldenCoffee;
  document.getElementById('clickPowerDisplay').textContent = gameState.clickPower;
  
  updateNotificationBadges();
  renderShop();
  renderUpgrades();
  renderPrestige();
  renderAchievements();
  checkAchievements();
}

function renderShop() {
  const container = document.getElementById('shopList');
  container.innerHTML = '';
  
  shopItems.forEach(item => {
    if (!gameState.items[item.id]) {
      gameState.items[item.id] = { count: 0, cost: item.baseCost };
    }
    
    const itemState = gameState.items[item.id];
    const currentCost = itemState.cost ?? item.baseCost;
    const currentCount = itemState.count ?? 0;
    const canAfford = gameState.coffee >= currentCost;
    const itemCPS = calculateItemCPS(item);
    
    const div = document.createElement('div');
    div.className = 'shop-item' + (canAfford ? ' affordable' : '');
    div.innerHTML = `
      <div class="item-info">
        <div class="item-name">${item.name}</div>
        <div class="item-effect">Effect: +${abbreviateNumber(itemCPS)} CPS</div>
      </div>
      <div class="item-actions">
        <div class="quantity-display">${currentCount}</div>
        <button class="buy-btn" ${!canAfford ? 'disabled' : ''}>BUY</button>
        <div class="cost-tile">☕ ${abbreviateNumber(currentCost)}</div>
      </div>
    `;
    
    div.querySelector('.buy-btn').onclick = () => buyItem(item.id);
    container.appendChild(div);
  });
}

let previouslyUnlockedUpgrades = new Set();

function renderUpgrades() {
  const container = document.getElementById('upgradesList');
  container.innerHTML = '';
  container.className = 'achievements-grid';
  
  const currentTab = document.querySelector('.tab-btn.active')?.dataset.tab;
  
  upgradePacks.forEach(pack => {
    const packUpgrades = upgrades.filter(u => u.pack === pack.id);
    if (packUpgrades.length === 0) return;
    
    const unlockedUpgrades = packUpgrades.filter(u => u.unlockCondition());
    if (unlockedUpgrades.length === 0) return;
    
    const newlyUnlocked = unlockedUpgrades.filter(u => 
      !previouslyUnlockedUpgrades.has(u.id) && 
      !gameState.purchasedUpgrades.has(u.id)
    );
    
    if (newlyUnlocked.length > 0 && currentTab !== 'upgrades') {
      showNotification(
        'New Upgrades Available!',
        `${pack.name}: ${newlyUnlocked.length} upgrade${newlyUnlocked.length > 1 ? 's' : ''} unlocked`,
        'upgrade',
        { packId: pack.id }
      );
    }
    
    newlyUnlocked.forEach(u => previouslyUnlockedUpgrades.add(u.id));
    
    const purchasedUpgrades = packUpgrades.filter(u => gameState.purchasedUpgrades.has(u.id));
    const affordableUpgrades = unlockedUpgrades.filter(u => 
      !gameState.purchasedUpgrades.has(u.id) && 
      gameState.coffee >= u.cost
    );
    
    if (currentTab === 'upgrades') {
      unlockedUpgrades.forEach(u => {
        if (!gameState.purchasedUpgrades.has(u.id)) {
          gameState.viewedUpgrades.add(u.id);
        }
      });
    }
    
    const isCollapsed = gameState.collapsedPacks.has(pack.id);
    const progressPercent = packUpgrades.length > 0 ? Math.round((purchasedUpgrades.length / packUpgrades.length) * 100) : 0;
    
    const packDiv = document.createElement('div');
    packDiv.className = 'upgrade-pack';
    
    const previewUpgrades = unlockedUpgrades.slice(0, 8);
    packDiv.innerHTML = `
      <div class="upgrade-pack-header">
        <div class="upgrade-pack-title">
          <span>${pack.name}</span>
        </div>
      </div>
      <div class="upgrade-pack-description">${pack.description}</div>
      <div class="progress" style="margin-bottom: 12px;">
        <div class="progress-bar" style="width: ${progressPercent}%; background: #d4a574;"></div>
      </div>
      <div class="upgrade-pack-preview">
        ${previewUpgrades.map(u => {
          const purchased = gameState.purchasedUpgrades.has(u.id);
          const affordable = !purchased && gameState.coffee >= u.cost && u.unlockCondition();
          return `<span class="upgrade-pack-badge" ${affordable ? 'title="Affordable" aria-label="Affordable"' : ''}>${purchased ? '✓' : (affordable ? '!' : '○')}</span>`;
        }).join('')}
        ${unlockedUpgrades.length > 8 ? '<span style="opacity: 0.6;">...</span>' : ''}
      </div>
      ${affordableUpgrades.length > 0 ? `<div style="color: #4CAF50; font-weight: 600; font-size: 0.9rem; margin-top: 8px;">${affordableUpgrades.length} affordable upgrade${affordableUpgrades.length !== 1 ? 's' : ''}</div>` : ''}
      <div class="upgrade-pack-toggle">${isCollapsed ? '▼ Click to expand' : '▲ Click to collapse'}</div>
    `;
    
    packDiv.onclick = (e) => {
      if (!e.target.closest('.upgrade-buy-btn')) {
        toggleUpgradePack(pack.id);
      }
    };
    
    const contentDiv = document.createElement('div');
    contentDiv.className = `upgrade-pack-content ${isCollapsed ? 'collapsed' : ''}`;
    
    unlockedUpgrades.forEach(upgrade => {
      const purchased = gameState.purchasedUpgrades.has(upgrade.id);
      const canAfford = gameState.coffee >= upgrade.cost && !purchased;
      
      const upgradeDiv = document.createElement('div');
      upgradeDiv.className = 'upgrade-item';
      if (canAfford) upgradeDiv.classList.add('affordable');
      if (purchased) upgradeDiv.classList.add('purchased');
      
      upgradeDiv.innerHTML = `
        <div class="upgrade-header">
          <div class="upgrade-name">${upgrade.name}</div>
          <div class="upgrade-status">${purchased ? '✓ OWNED' : ''}</div>
        </div>
        <div class="upgrade-description">${upgrade.description}</div>
        <div class="upgrade-footer">
          <div class="cost-tile">☕ ${abbreviateNumber(upgrade.cost)}</div>
          <button class="upgrade-buy-btn" ${!canAfford || purchased ? 'disabled' : ''}>
            ${purchased ? 'PURCHASED' : 'BUY UPGRADE'}
          </button>
        </div>
      `;
      
      if (!purchased) {
        upgradeDiv.querySelector('.upgrade-buy-btn').onclick = (e) => {
          e.stopPropagation();
          buyUpgrade(upgrade.id);
        };
      }
      
      contentDiv.appendChild(upgradeDiv);
    });
    
    packDiv.appendChild(contentDiv);
    container.appendChild(packDiv);
  });
  
  if (container.children.length === 0) {
    container.innerHTML = '<div class="empty-state">No upgrades available yet. Keep brewing coffee and purchasing items to unlock upgrades!</div>';
  }
}

function toggleUpgradePack(packId) {
  if (gameState.collapsedPacks.has(packId)) {
    gameState.collapsedPacks.delete(packId);
  } else {
    gameState.collapsedPacks.add(packId);
  }
  renderUpgrades();
  saveGame();
}

function renderPrestige() {
  const container = document.getElementById('prestigeContent');
  const goldenCoffeeToGain = Math.floor(gameState.totalCoffeeAllTime / 10000000000);
  const newMultiplier = 1 + (goldenCoffeeToGain * 0.1);
  const canPrestige = goldenCoffeeToGain > gameState.goldenCoffee;
  
  container.innerHTML = `
    <div class="prestige-container">
      <div class="prestige-info">
        <h3 style="color: #ffd700; font-size: 1.5rem; margin: 0 0 16px 0;">Golden Coffee System</h3>
        <p>Reset your progress to earn Golden Coffee for permanent production multipliers!</p>
        <div style="font-size: 2rem; font-weight: 700; color: #ffd700; margin: 16px 0;">
          Current Multiplier: ${gameState.prestigeMultiplier.toFixed(1)}x
        </div>
      </div>
      <div style="background: rgba(255, 255, 255, 0.05); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
        <p><strong>How it works:</strong></p>
        <p>• Every 10B total coffees = 1 Golden Coffee</p>
        <p>• Each Golden Coffee gives +10% production (permanent!)</p>
        <p>• Prestiging resets coffee, items, and upgrades</p>
        <p>• Golden Coffee and multiplier are kept forever</p>
      </div>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin: 20px 0;">
        <div style="background: rgba(255, 255, 255, 0.05); padding: 16px; border-radius: 12px;">
          <div style="opacity: 0.8; margin-bottom: 8px;">Total Coffee Brewed</div>
          <div style="font-size: 1.8rem; font-weight: 700; color: #ffd700;">${goldenCoffeeToGain}</div>
        </div>
      </div>
      ${canPrestige ? `
        <div style="text-align: center; font-size: 1.2rem; color: #4CAF50; font-weight: 600; margin: 12px 0;">
          You will gain ${goldenCoffeeToGain - gameState.goldenCoffee} Golden Coffee!
        </div>
        <div style="text-align: center; font-size: 1.2rem; color: #4CAF50; font-weight: 600; margin: 12px 0;">
          New Multiplier: ${newMultiplier.toFixed(1)}x (from ${gameState.prestigeMultiplier.toFixed(1)}x)
        </div>
      ` : `
        <div style="text-align: center; margin: 20px 0; font-size: 1.1rem; opacity: 0.8;">
          Need ${abbreviateNumber((gameState.goldenCoffee + 1) * 10000000000)} total coffees to prestige
          <br>Current: ${abbreviateNumber(gameState.totalCoffeeAllTime)}
        </div>
      `}
      <button class="prestige-button" ${!canPrestige ? 'disabled' : ''}>
        ${canPrestige ? 'PRESTIGE NOW' : 'Not Enough Coffee Yet'}
      </button>
    </div>
  `;
  
  const btn = container.querySelector('.prestige-button');
  if (canPrestige) {
    btn.onclick = doPrestige;
  }
}

function renderAchievements() {
  const container = document.getElementById('achievementsList');
  container.innerHTML = '';
  container.className = 'achievements-grid';
  
  const packs = getAchievementPacks();
  packs.forEach(pack => {
    const visibleAchievements = getVisibleAchievements(pack.achievements);
    
    if (visibleAchievements.length === 0) return;
    
    const earnedCount = pack.achievements.filter(a => a.earned).length;
    const totalCount = pack.achievements.length;
    const progressPercent = totalCount > 0 ? Math.round((earnedCount / totalCount) * 100) : 0;
    
    const unclaimedInPack = pack.achievements.filter(a => gameState.unclaimedAchievements.has(a.id)).length;
    
    const div = document.createElement('div');
    div.className = 'achievement-pack';
    
    const badgeHTML = unclaimedInPack > 0 ? `<div class="notification-badge">${unclaimedInPack}</div>` : '';
    
    div.innerHTML = `
      ${badgeHTML}
      <div class="pack-header">
        <div class="pack-title">${pack.title}</div>
      </div>
      <div class="pack-description">${pack.description}</div>
      <div class="progress" style="margin-bottom: 12px;">
        <div class="progress-bar" style="width: ${progressPercent}%; background: #4CAF50;"></div>
      </div>
      <div class="pack-preview">
        ${visibleAchievements.slice(0, 8).map(a => {
          const isUnclaimed = gameState.unclaimedAchievements.has(a.id);
          return `<span class="pack-badge">${a.earned ? (isUnclaimed ? '!' : '✓') : '○'}</span>`;
        }).join('')}
        ${visibleAchievements.length > 8 ? '<span style="opacity: 0.6;">...</span>' : ''}
      </div>
    `;
    
    div.onclick = () => openAchievementModal(pack);
    container.appendChild(div);
  });
}

function openAchievementModal(pack) {
  const modal = document.getElementById('achievementModal');
  const modalTitle = document.getElementById('modalTitle');
  const modalAchievements = document.getElementById('modalAchievements');
  
  modalTitle.textContent = pack.title;
  modalAchievements.innerHTML = '';
  
  const visibleAchievements = getVisibleAchievements(pack.achievements);
  
  visibleAchievements.forEach(a => {
    const isUnclaimed = gameState.unclaimedAchievements.has(a.id);
    const isClaimed = a.earned && !isUnclaimed;
    
    const div = document.createElement('div');
    
    if (isUnclaimed) {
      div.className = 'modal-achievement unlocked unclaimed';
    } else if (isClaimed) {
      div.className = 'modal-achievement claimed';
    } else {
      div.className = 'modal-achievement';
    }
    
    div.innerHTML = `
      <div style="font-size: 1.1rem; font-weight: 700; margin-bottom: 4px;">
        ${a.earned ? (isUnclaimed ? '!' : '✓') : '○'} ${a.name}
      </div>
      <div style="opacity: 0.9; margin-bottom: 8px; font-size: 0.9rem;">${a.requirement}</div>
      ${a.reward ? `<div class="achievement-reward">${getRewardText(a.reward)}${isUnclaimed ? ' - Click to claim!' : ''}</div>` : ''}
      <div class="progress">
        <div class="progress-bar" style="width: ${a.percent()}%; ${a.earned ? 'background: #4CAF50;' : ''}"></div>
      </div>
    `;
    
    if (isUnclaimed) {
      div.onclick = () => {
        claimAchievementReward(a);
        openAchievementModal(pack);
        renderAchievements();
      };
    }
    
    modalAchievements.appendChild(div);
  });
  
  modal.classList.remove('hidden');
}

function closeAchievementModal() {
  document.getElementById('achievementModal').classList.add('hidden');
}

function openVersionInfo() {
  document.getElementById('versionModal').classList.remove('hidden');
}

function closeVersionInfo() {
  document.getElementById('versionModal').classList.add('hidden');
}

function openHelp() {
  document.getElementById('instructionsOverlay').classList.remove('hidden');
}

function closeInstructions() {
  document.getElementById('instructionsOverlay').classList.add('hidden');
}

function buyItem(itemId) {
  const shopItem = shopItems.find(i => i.id === itemId);
  if (!shopItem) return;
  
  if (!gameState.items[itemId]) {
    gameState.items[itemId] = { count: 0, cost: shopItem.baseCost };
  }
  
  const itemState = gameState.items[itemId];
  const currentCost = itemState.cost ?? shopItem.baseCost;
  
  if (gameState.coffee >= currentCost) {
    gameState.coffee -= currentCost;
    itemState.count = (itemState.count ?? 0) + 1;
    itemState.cost = Math.floor(shopItem.baseCost * Math.pow(shopItem.scale, itemState.count));
    
    showPurchaseNotification(shopItem.name);
    
    saveGame();
    updateUI();
  }
}

function buyUpgrade(upgradeId) {
  const upgrade = upgrades.find(u => u.id === upgradeId);
  if (!upgrade || gameState.purchasedUpgrades.has(upgradeId)) return;
  
  if (gameState.coffee >= upgrade.cost) {
    gameState.coffee -= upgrade.cost;
    gameState.purchasedUpgrades.add(upgradeId);
    gameState.viewedUpgrades.add(upgradeId);
    upgrade.effect();
    
    const packId = upgrade.pack;
    if (packId) {
      removeNotificationsByPack(packId);
    }
    
    showPurchaseNotification(upgrade.name);
    
    saveGame();
    updateUI();
  }
}

function doPrestige() {
  const goldenCoffeeToGain = Math.floor(gameState.totalCoffeeAllTime / 10000000000);
  if (goldenCoffeeToGain > gameState.goldenCoffee) {
    const gained = goldenCoffeeToGain - gameState.goldenCoffee;
    if (confirm(`Prestige and gain ${gained} Golden Coffee?\n\nThis will reset:\n• Coffee count\n• All items\n• All upgrades\n\nYou will keep:\n• Golden Coffee\n• ${(goldenCoffeeToGain * 10)}% production multiplier\n• All achievements`)) {
      gameState.goldenCoffee = goldenCoffeeToGain;
      gameState.prestigeMultiplier = 1 + (gameState.goldenCoffee * 0.1);
      
      gameState.coffee = 0;
      gameState.clickPower = 1;
      gameState.purchasedUpgrades = new Set();
      gameState.itemMultipliers = {};
      
      previouslyUnlockedUpgrades = new Set();
      
      shopItems.forEach(item => {
        gameState.items[item.id] = { count: 0, cost: item.baseCost };
      });
      
      showPurchaseNotification(`Prestiged! Gained ${gained} Golden Coffee!`);
      saveGame();
      updateUI();
    }
  }
}

function checkAchievements() {
  gameState.achievements.forEach(a => {
    if (a.condition() && !a.earned) {
      a.earned = true;
      gameState.unclaimedAchievements.add(a.id);
      
      showNotification(
        'Achievement Unlocked!',
        `${a.name}`,
        'achievement',
        { achievementId: a.id }
      );
      
      saveGame();
    }
  });
}

document.getElementById('coffeeButton').onclick = () => {
  const earned = gameState.clickPower * gameState.prestigeMultiplier;
  gameState.coffee += earned;
  gameState.totalCoffeeAllTime += earned;
  
  gameState.targetCoffee = gameState.coffee;
  
  const btn = document.getElementById('coffeeButton');
  btn.style.transform = 'scale(0.9)';
  setTimeout(() => btn.style.transform = 'scale(1)', 100);
};

function smoothAnimate() {
  const lerpFactor = 0.15;
  
  const coffeeDiff = gameState.targetCoffee - gameState.displayCoffee;
  if (Math.abs(coffeeDiff) > 0.01) {
    gameState.displayCoffee += coffeeDiff * lerpFactor;
  } else {
    gameState.displayCoffee = gameState.targetCoffee;
  }
  
  const cpsDiff = gameState.targetCPS - gameState.displayCPS;
  if (Math.abs(cpsDiff) > 0.01) {
    gameState.displayCPS += cpsDiff * lerpFactor;
  } else {
    gameState.displayCPS = gameState.targetCPS;
  }
}

let lastRenderTime = Date.now();

setInterval(() => {
  const totalCPS = calculateTotalCPS();
  const coffeePerTick = totalCPS / 10;
  
  if (totalCPS > 0) {
    gameState.coffee += coffeePerTick;
    gameState.totalCoffeeAllTime += coffeePerTick;
    gameState.targetCoffee = gameState.coffee;
  }
  
  gameState.targetCPS = totalCPS;
  smoothAnimate();
  
  const now = Date.now();
  if (now - lastRenderTime > 16) {
    document.getElementById('coffeeDisplay').textContent = abbreviateNumber(gameState.displayCoffee);
    document.getElementById('cpsDisplay').textContent = abbreviateNumber(gameState.displayCPS);
    lastRenderTime = now;
  }
}, 100);

setInterval(() => {
  updateUI();
}, 1000);

setInterval(() => {
  saveGame();
}, 30000);

document.querySelectorAll('.tab-btn').forEach(btn => {
  btn.onclick = () => {
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
    
    btn.classList.add('active');
    const tabId = btn.dataset.tab + 'Tab';
    document.getElementById(tabId).classList.add('active');
    
    updateUI();
    saveGame();
  };
});

document.addEventListener('keydown', (e) => {
  const key = e.key;
  const tabs = ['brew', 'shop', 'upgrades', 'prestige', 'achievements'];
  const index = parseInt(key) - 1;
  
  if (index >= 0 && index < tabs.length) {
    const btn = document.querySelector(`[data-tab="${tabs[index]}"]`);
    if (btn) btn.click();
  }
});

document.getElementById('helpBtn').onclick = openHelp;
document.getElementById('infoBtn').onclick = openVersionInfo;
document.getElementById('startGameBtn').onclick = closeInstructions;
document.getElementById('closeVersionModal').onclick = closeVersionInfo;
document.getElementById('closeAchievementModal').onclick = closeAchievementModal;

document.getElementById('achievementModal').onclick = (e) => {
  if (e.target.id === 'achievementModal') {
    closeAchievementModal();
  }
};

document.getElementById('versionModal').onclick = (e) => {
  if (e.target.id === 'versionModal') {
    closeVersionInfo();
  }
};

document.getElementById('instructionsOverlay').onclick = (e) => {
  if (e.target.id === 'instructionsOverlay') {
    closeInstructions();
  }
};

const hasExistingSave = loadGame();

if (!hasExistingSave) {
  document.getElementById('instructionsOverlay').classList.remove('hidden');
} else {
  document.getElementById('instructionsOverlay').classList.add('hidden');
}

document.getElementById('versionModal').classList.add('hidden');

gameState.targetCoffee = gameState.coffee;
gameState.displayCoffee = gameState.coffee;
gameState.targetCPS = calculateTotalCPS();
gameState.displayCPS = gameState.targetCPS;

updateUI();
</script>
</body>
</html>
